"use strict";(self.webpackChunkfront=self.webpackChunkfront||[]).push([[593],{3593:(Z,m,i)=>{i.r(m),i.d(m,{CreateSellOrderModule:()=>q});var a=i(6019),h=i(850),g=i(7537),p=i(1435),_=i(7591),c=i(4684),C=i(8260),e=i(1514),u=i(7754),f=i(6588),x=i(6155),T=i(7788);function A(o,s){1&o&&(e.ynx(0),e._UZ(1,"i",28),e._uU(2," Guardar "),e.BQk())}function v(o,s){1&o&&(e.ynx(0),e._UZ(1,"i",29),e.BQk())}function O(o,s){if(1&o&&(e.TgZ(0,"ng-option",32),e._uU(1),e.qZA()),2&o){const t=s.$implicit,n=e.oxw(2);e.Q6J("value",t),e.xp6(1),e.hij(" ",n.GenerateClientAddress(t)," ")}}function M(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"ng-select",30),e.NdJ("ngModelChange",function(r){return e.CHM(t),e.oxw().selectedAddress=r}),e.YNc(1,O,2,2,"ng-option",31),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("disabled",1==t.selectedClient.addresses.length)("ngModel",t.selectedAddress),e.xp6(1),e.Q6J("ngForOf",t.selectedClient.addresses)}}function b(o,s){if(1&o&&e._UZ(0,"app-date-picker",33),2&o){const t=e.oxw();e.Q6J("presetDate",t.orderDate.format("YYYY/MM/DD"))}}function S(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"tr"),e.TgZ(1,"td",34),e.TgZ(2,"div",35),e.TgZ(3,"i",36),e.NdJ("click",function(){const l=e.CHM(t).index;return e.oxw().RemoveItem(l)}),e.qZA(),e._uU(4),e.qZA(),e.qZA(),e.TgZ(5,"td",37),e.TgZ(6,"ng-select",38),e.NdJ("change",function(){const l=e.CHM(t).$implicit;return e.oxw().OnWeightOrQuantityChange(l)})("ngModelChange",function(r){return e.CHM(t).$implicit.product=r}),e.qZA(),e.qZA(),e.TgZ(7,"td",39),e.TgZ(8,"div",40),e.TgZ(9,"input",41),e.NdJ("input",function(){const l=e.CHM(t).$implicit;return e.oxw().OnWeightOrQuantityChange(l)})("ngModelChange",function(r){return e.CHM(t).$implicit.quantity=r}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(10,"td",39),e.TgZ(11,"div",40),e.TgZ(12,"input",42),e.NdJ("input",function(){const l=e.CHM(t).$implicit;return e.oxw().OnWeightOrQuantityChange(l)})("ngModelChange",function(r){return e.CHM(t).$implicit.weight=r}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(13,"td",39),e._uU(14),e.ALo(15,"number"),e.qZA(),e.TgZ(16,"td",39),e._uU(17),e.ALo(18,"number"),e.qZA(),e.TgZ(19,"td",39),e._uU(20),e.ALo(21,"number"),e.qZA(),e.qZA()}if(2&o){const t=s.$implicit,n=s.index,r=e.oxw();e.xp6(4),e.hij(" ",n+1," "),e.xp6(2),e.Q6J("items",r.products)("disabled",!r.selectedClient)("ngModel",t.product),e.xp6(3),e.Q6J("disabled",!r.selectedClient)("ngModel",t.quantity),e.xp6(3),e.Q6J("disabled",!r.selectedClient)("ngModel",t.weight),e.xp6(2),e.hij(" $",e.xi3(15,11,t.tax,"0.2-2")," "),e.xp6(3),e.hij(" $",e.xi3(18,14,t.price,"0.2-2")," "),e.xp6(3),e.hij(" $",e.xi3(21,17,t.total,"0.2-2")," ")}}const y=[{path:"",component:(()=>{class o{constructor(t,n,r){this.http=t,this.toast=n,this.nav=r,this.IVA=.16,this.clients=[],this.selectedClient=null,this.selectedAddress=null,this.measurementTypes=[],this.products=[],this.orderItems=[],this.orderItem={product:null,quantity:null,weight:null,tax:0,price:0,total:0},this.orderDate=c().tz(C.N.timezone).add(4,"hours"),this.loading={getting:!1,creating:!1}}get orderSubtotal(){let t=0;return this.orderItems.forEach(n=>{n.price&&(t+=n.price)}),t}get orderTaxes(){let t=0;return this.orderItems.forEach(n=>{n.tax&&(t+=n.tax)}),t}get orderTotal(){let t=0;return this.orderItems.forEach(n=>{n.total&&(t+=n.total)}),t}ngOnInit(){this.GetClients(),this.GetProducts(),this.PushItem()}GoBack(){this.nav.GoToRoleRoute("sell-orders")}GetMeasurementTypes(){this.http.Get("MeasurementTypes").subscribe(t=>{this.measurementTypes=t},t=>{console.error("Error getting measurement types",t)})}GetProducts(){this.http.Get(`Products/WithPriceHistory/FilteredBy/Text/*/StartDate/${this.orderDate.format("YYYY-MM-DD")}/EndDate/${this.orderDate.format("YYYY-MM-DD")}`).subscribe(t=>{this.products=t},t=>{console.error("Error getting products",t)})}GetClients(){this.http.Get("/Clients").subscribe(n=>{this.clients=n},n=>{console.error("Error getting clients",n)})}PushItem(){this.orderItems.push(Object.assign({},this.orderItem))}RemoveItem(t){this.orderItems.length>1&&this.orderItems.splice(t,1)}OnWeightOrQuantityChange(t){if(t.product){const n=t.product.prices.length?t.product.prices[0].salePrice:t.product.price;let r=0;if(r="pz"===t.product.salesMeasurementType.abrev?t.quantity?t.quantity:0:t.weight?t.weight:0,!Number.isNaN(Number(r))){const l=n*Number(this.selectedClient.utilityPercentage)/100;t.price=Number(r)*(n+l),t.tax=t.price*this.IVA,t.total=t.price+t.tax}}}SaveOrder(){let t=this.ValidateOrderData();if(t)return void this.toast.ShowDefaultWarning(t,"La orden no es valida");let n={date:this.orderDate.toISOString(),items:this.orderItems,subtotal:this.orderSubtotal,taxes:this.orderTaxes,total:this.orderTotal,client:this.selectedClient,clientId:this.selectedClient.id,clientAddress:this.selectedAddress};this.http.Post("Orders",{order:n}).subscribe(r=>{this.toast.ShowDefaultSuccess("Orden creada exitosamente"),this.nav.GoToRoleRoute("sell-orders")},r=>{console.error("Error creating order",r)})}ValidateOrderData(){let t=null;return this.selectedClient?this.selectedAddress?(this.orderItems.forEach((n,r)=>{if(!n.product)return t=`La fila ${r+1} no tiene producto seleccionado`}),t):"No ha seleccionado una direcci\xf3n":"No ha seleccionado cliente"}OnClientSelected(t){if(t){const n=t.addresses.find(r=>r.isDefault);this.selectedAddress=n||t.addresses[0]}}GenerateClientAddress(t){return t?t.street+" #"+t.externalNumber+(t.internalNumber?" int. "+t.internalNumber:""):""}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(u.O),e.Y36(f.k),e.Y36(x.f))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-create-sell-order"]],decls:64,vars:21,consts:[[1,"content","d-flex","flex-column"],[1,"d-flex","align-items-center","justify-content-between"],[1,"page-title"],[1,"zmdi","zmdi-arrow-back","zmdi-hc-lg","mr-2","clickeable",3,"click"],[1,"d-flex"],[1,"btn","btn-success","mx-1",3,"disabled","click"],[4,"ngIf"],[1,"head-row"],[1,"form-group","head-item"],[1,"d-flex","flex-column",2,"gap","12px"],["bindLabel","name","placeholder","Clientes",1,"clients-select",3,"items","ngModel","change","ngModelChange"],[1,"fake-form-control","head-item"],["class","clients-select","placeholder","Direcci\xf3n",3,"disabled","ngModel","ngModelChange",4,"ngIf"],["class","head-item","placeholder","Selecciona una fecha",3,"presetDate",4,"ngIf"],[1,"flex-grow-1","overflow-auto"],[1,"table"],[1,"position-sticky",2,"top","0","z-index","1"],[1,"small-width"],[1,"medium-width"],[4,"ngFor","ngForOf"],["colspan","7",1,"px-0"],[1,"btn","btn-outline-success","btn-block","d-flex","align-items-center","justify-content-center",3,"click"],[1,"zmdi","zmdi-plus","zmdi-hc-lg","mr-2"],[1,"order-summary"],[1,"card"],[1,"d-flex","flex-column"],[1,"summary-row"],[2,"font-weight","600"],[1,"zmdi","zmdi-save","zmdi-hc-lg","mr-2"],[1,"zmdi","zmdi-spinner","zmdi-hc-spin","zmdi-hc-lg"],["placeholder","Direcci\xf3n",1,"clients-select",3,"disabled","ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["placeholder","Selecciona una fecha",1,"head-item",3,"presetDate"],[1,"align-middle","small-width",2,"max-width","50px !important"],[1,"d-flex","align-items-center","justify-content-center"],[1,"zmdi","zmdi-close-circle","zmdi-hc-lg","clickeable","mr-3",3,"click"],[1,"align-middle",2,"width","150px","max-width","100%"],["bindLabel","name","placeholder","Productos",1,"",3,"items","disabled","ngModel","change","ngModelChange"],[1,"align-middle","medium-width"],[1,"input-container"],["placeholder","Piezas","type","text",1,"form-control","no-icon",3,"disabled","ngModel","input","ngModelChange"],["placeholder","Kilogramos","type","text",1,"form-control","no-icon",3,"disabled","ngModel","input","ngModelChange"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e.TgZ(3,"i",3),e.NdJ("click",function(){return n.GoBack()}),e.qZA(),e._uU(4," Crear orden de venta "),e.qZA(),e.TgZ(5,"div",4),e.TgZ(6,"button",5),e.NdJ("click",function(){return n.SaveOrder()}),e.YNc(7,A,3,0,"ng-container",6),e.YNc(8,v,2,0,"ng-container",6),e.qZA(),e.qZA(),e.qZA(),e.TgZ(9,"div",7),e.TgZ(10,"div",8),e.TgZ(11,"div",9),e.TgZ(12,"ng-select",10),e.NdJ("change",function(l){return n.OnClientSelected(l)})("ngModelChange",function(l){return n.selectedClient=l}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(13,"div",11),e._uU(14),e.qZA(),e.TgZ(15,"div",8),e.YNc(16,M,2,3,"ng-select",12),e.qZA(),e.YNc(17,b,1,1,"app-date-picker",13),e.qZA(),e.TgZ(18,"div",14),e.TgZ(19,"table",15),e.TgZ(20,"thead",16),e.TgZ(21,"tr"),e.TgZ(22,"th",17),e._uU(23,"#"),e.qZA(),e.TgZ(24,"th",18),e._uU(25,"Producto"),e.qZA(),e.TgZ(26,"th",18),e._uU(27,"Cantidad Pz"),e.qZA(),e.TgZ(28,"th",18),e._uU(29,"Cantidad Kg"),e.qZA(),e.TgZ(30,"th",18),e._uU(31,"Impuesto"),e.qZA(),e.TgZ(32,"th",18),e._uU(33,"Precio"),e.qZA(),e.TgZ(34,"th",18),e._uU(35,"Total"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(36,"tbody"),e.YNc(37,S,22,20,"tr",19),e.TgZ(38,"tr"),e.TgZ(39,"td",20),e.TgZ(40,"button",21),e.NdJ("click",function(){return n.PushItem()}),e._UZ(41,"i",22),e._uU(42," Agregar "),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(43,"div",23),e.TgZ(44,"div",24),e.TgZ(45,"div",25),e.TgZ(46,"div",26),e.TgZ(47,"span",27),e._uU(48,"Subtotal"),e.qZA(),e.TgZ(49,"span"),e._uU(50),e.ALo(51,"number"),e.qZA(),e.qZA(),e.TgZ(52,"div",26),e.TgZ(53,"span",27),e._uU(54,"Impuesto"),e.qZA(),e.TgZ(55,"span"),e._uU(56),e.ALo(57,"number"),e.qZA(),e.qZA(),e.TgZ(58,"div",26),e.TgZ(59,"span",27),e._uU(60,"Total"),e.qZA(),e.TgZ(61,"span"),e._uU(62),e.ALo(63,"number"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.xp6(6),e.Q6J("disabled",n.loading.creating),e.xp6(1),e.Q6J("ngIf",!n.loading.creating),e.xp6(1),e.Q6J("ngIf",n.loading.creating),e.xp6(4),e.Q6J("items",n.clients)("ngModel",n.selectedClient),e.xp6(2),e.hij(" ",null!=n.selectedClient&&n.selectedClient.socialReason?n.selectedClient.socialReason:"Raz\xf3n social"," "),e.xp6(2),e.Q6J("ngIf",!!n.selectedClient),e.xp6(1),e.Q6J("ngIf",!!n.orderDate),e.xp6(20),e.Q6J("ngForOf",n.orderItems),e.xp6(13),e.hij("$",e.xi3(51,12,n.orderSubtotal,"0.2-2"),""),e.xp6(6),e.hij("$",e.xi3(57,15,n.orderTaxes,"0.2-2"),""),e.xp6(6),e.hij("$",e.xi3(63,18,n.orderTotal,"0.2-2"),""))},directives:[a.O5,p.w9,g.JJ,g.On,a.sg,p.xv,T.L,g.Fj],pipes:[a.JJ],styles:[".clients-select[_ngcontent-%COMP%]{width:100%}.head-row[_ngcontent-%COMP%]{display:flex;align-items:center;grid-gap:24px;gap:24px}.head-item[_ngcontent-%COMP%]{flex-grow:1;flex-basis:33%}.small-width[_ngcontent-%COMP%]{max-width:70px}.medium-width[_ngcontent-%COMP%]{min-width:120px}table[_ngcontent-%COMP%]{overflow-y:visible!important}.order-summary[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;margin:1rem 0}.summary-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;color:#000;font-size:1.25rem}.order-summary[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{width:400px;max-width:100%}"]}),o})()}];let q=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[g.u5,a.ez,p.A0,_.I,g.UX,h.Bz.forChild(y)]]}),o})()},6155:(Z,m,i)=>{i.d(m,{f:()=>_});var a=i(1514),h=i(850),g=i(9299),p=i(6588);let _=(()=>{class c{constructor(e,u,f){this.router=e,this.role=u,this.toast=f}FormatRoute(e){return"/"==e.charAt(0)?`${e.split("").slice(1).join("")}`:e}GoToRoleRoute(e){const u=this.role.GetUserRole();u?this.router.navigate([`/${u.toLowerCase()}/${this.FormatRoute(e)}`]):this.toast.ShowDefaultDanger("Rol de usuario no valido","Ruta invalida")}}return c.\u0275fac=function(e){return new(e||c)(a.LFG(h.F0),a.LFG(g.N),a.LFG(p.k))},c.\u0275prov=a.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})()}}]);