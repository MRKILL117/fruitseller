"use strict";(self.webpackChunkfront=self.webpackChunkfront||[]).push([[593],{3593:(S,u,l)=>{l.r(u),l.d(u,{CreateSellOrderModule:()=>q});var c=l(6019),p=l(850),a=l(7537),g=l(1435),m=l(7591),h=l(4684),C=l(8260),e=l(1514),_=l(7754),Z=l(6588),f=l(6155),x=l(7788);function T(i,s){1&i&&(e.ynx(0),e._UZ(1,"i",26),e._uU(2," Guardar "),e.BQk())}function A(i,s){1&i&&(e.ynx(0),e._UZ(1,"i",27),e.BQk())}function O(i,s){if(1&i&&(e.TgZ(0,"ng-option",30),e._uU(1),e.qZA()),2&i){const t=s.$implicit,n=e.oxw(2);e.Q6J("value",t),e.xp6(1),e.hij(" ",n.GenerateClientAddress(t)," ")}}function M(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"ng-select",28),e.NdJ("ngModelChange",function(r){return e.CHM(t),e.oxw().selectedAddress=r}),e.YNc(1,O,2,2,"ng-option",29),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("disabled",1==t.selectedClient.addresses.length)("ngModel",t.selectedAddress),e.xp6(1),e.Q6J("ngForOf",t.selectedClient.addresses)}}function b(i,s){if(1&i&&e._UZ(0,"app-date-picker",31),2&i){const t=e.oxw();e.Q6J("presetDate",t.orderDate.format("YYYY/MM/DD"))}}function v(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"tr"),e.TgZ(1,"td",32),e.TgZ(2,"div",33),e.TgZ(3,"i",34),e.NdJ("click",function(){const o=e.CHM(t).index;return e.oxw().RemoveItem(o)}),e.qZA(),e._uU(4),e.qZA(),e.qZA(),e.TgZ(5,"td",35),e.TgZ(6,"ng-select",36),e.NdJ("change",function(){const o=e.CHM(t).$implicit;return e.oxw().OnWeightOrQuantityChange(o)})("ngModelChange",function(r){return e.CHM(t).$implicit.product=r}),e.qZA(),e.qZA(),e.TgZ(7,"td",37),e.TgZ(8,"div",38),e.TgZ(9,"input",39),e.NdJ("input",function(){const o=e.CHM(t).$implicit;return e.oxw().OnWeightOrQuantityChange(o)})("ngModelChange",function(r){return e.CHM(t).$implicit.quantity=r}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(10,"td",37),e.TgZ(11,"div",38),e.TgZ(12,"input",40),e.NdJ("input",function(){const o=e.CHM(t).$implicit;return e.oxw().OnWeightOrQuantityChange(o)})("ngModelChange",function(r){return e.CHM(t).$implicit.weight=r}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(13,"td",37),e._uU(14),e.ALo(15,"number"),e.qZA(),e.TgZ(16,"td",37),e._uU(17),e.ALo(18,"number"),e.qZA(),e.TgZ(19,"td",37),e._uU(20),e.ALo(21,"number"),e.qZA(),e.qZA()}if(2&i){const t=s.$implicit,n=s.index,r=e.oxw();e.xp6(4),e.hij(" ",n+1," "),e.xp6(2),e.Q6J("items",r.products)("disabled",!r.selectedClient)("ngModel",t.product),e.xp6(3),e.Q6J("disabled",!r.selectedClient)("ngModel",t.quantity),e.xp6(3),e.Q6J("disabled",!r.selectedClient)("ngModel",t.weight),e.xp6(2),e.hij(" $",e.xi3(15,11,t.tax,"0.2-2")," "),e.xp6(3),e.hij(" $",e.xi3(18,14,t.price,"0.2-2")," "),e.xp6(3),e.hij(" $",e.xi3(21,17,t.total,"0.2-2")," ")}}const y=[{path:"",component:(()=>{class i{constructor(t,n,r){this.http=t,this.toast=n,this.nav=r,this.IVA=.16,this.clients=[],this.selectedClient=null,this.selectedAddress=null,this.measurementTypes=[],this.products=[],this.orderItems=[],this.orderItem={product:null,quantity:null,weight:null,tax:0,price:0,total:0},this.orderDate=h().tz(C.N.timezone).add(4,"hours"),this.loading={getting:!1,creating:!1}}get orderSubtotal(){let t=0;return this.orderItems.forEach(n=>{n.price&&(t+=n.price)}),t}get orderTaxes(){let t=0;return this.orderItems.forEach(n=>{n.tax&&(t+=n.tax)}),t}get orderTotal(){let t=0;return this.orderItems.forEach(n=>{n.total&&(t+=n.total)}),t}ngOnInit(){this.GetClients(),this.GetProducts(),this.PushItem()}GoBack(){this.nav.GoToRoleRoute("sell-orders")}GetMeasurementTypes(){this.http.Get("MeasurementTypes").subscribe(t=>{this.measurementTypes=t},t=>{console.error("Error getting measurement types",t)})}GetProducts(){this.http.Get(`Products/WithPriceHistory/FilteredBy/Text/*/StartDate/${this.orderDate.format("YYYY-MM-DD")}/EndDate/${this.orderDate.format("YYYY-MM-DD")}`).subscribe(t=>{this.products=t},t=>{console.error("Error getting products",t)})}GetClients(){this.http.Get("/Clients").subscribe(n=>{this.clients=n},n=>{console.error("Error getting clients",n)})}PushItem(){this.orderItems.push(Object.assign({},this.orderItem))}RemoveItem(t){this.orderItems.length>1&&this.orderItems.splice(t,1)}OnWeightOrQuantityChange(t){if(t.product){const n=t.product.prices.length?t.product.prices[0].salePrice:t.product.price;let r=0;if(r="pz"===t.product.salesMeasurementType.abrev?t.quantity?t.quantity:0:t.weight?t.weight:0,!Number.isNaN(Number(r))){const o=n*Number(this.selectedClient.utilityPercentage)/100;t.price=Number(r)*(n+o),t.tax=t.price*this.IVA,t.total=t.price+t.tax}}}SaveOrder(){let t=this.ValidateOrderData();if(t)return void this.toast.ShowDefaultWarning(t,"La orden no es valida");let n={date:this.orderDate.toISOString(),items:this.orderItems,subtotal:this.orderSubtotal,taxes:this.orderTaxes,total:this.orderTotal,client:this.selectedClient,clientId:this.selectedClient.id,clientAddress:this.selectedAddress};this.http.Post("Orders",{order:n}).subscribe(r=>{this.toast.ShowDefaultSuccess("Orden creada exitosamente"),this.nav.GoToRoleRoute("sell-orders")},r=>{console.error("Error creating order",r)})}ValidateOrderData(){let t=null;return this.selectedClient?this.selectedAddress?(this.orderItems.forEach((n,r)=>{if(!n.product)return t=`La fila ${r+1} no tiene producto seleccionado`}),t):"No ha seleccionado una direcci\xf3n":"No ha seleccionado cliente"}OnClientSelected(t){if(t){const n=t.addresses.find(r=>r.isDefault);this.selectedAddress=n||t.addresses[0]}}GenerateClientAddress(t){return t?t.street+" #"+t.externalNumber+(t.internalNumber?" int. "+t.internalNumber:""):""}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(_.O),e.Y36(Z.k),e.Y36(f.f))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-create-sell-order"]],decls:61,vars:20,consts:[[1,"content","d-flex","flex-column"],[1,"d-flex","align-items-center","justify-content-between"],[1,"page-title"],[1,"zmdi","zmdi-arrow-back","zmdi-hc-lg","mr-2","clickeable",3,"click"],[1,"d-flex"],[1,"btn","btn-success","mx-1",3,"disabled","click"],[4,"ngIf"],[1,"head-row"],[1,"form-group","head-item","my-3"],["bindLabel","name","placeholder","Clientes",1,"clients-select",3,"items","ngModel","change","ngModelChange"],["class","clients-select","placeholder","Direcci\xf3n",3,"disabled","ngModel","ngModelChange",4,"ngIf"],["class","head-item my-3","placeholder","Selecciona una fecha",3,"presetDate",4,"ngIf"],[1,"flex-grow-1","overflow-auto"],[1,"table"],[1,"position-sticky",2,"top","0","z-index","1"],[1,"small-width"],[1,"medium-width"],[4,"ngFor","ngForOf"],["colspan","7",1,"px-0"],[1,"btn","btn-outline-success","btn-block","d-flex","align-items-center","justify-content-center",3,"click"],[1,"zmdi","zmdi-plus","zmdi-hc-lg","mr-2"],[1,"order-summary"],[1,"card"],[1,"d-flex","flex-column"],[1,"summary-row"],[2,"font-weight","600"],[1,"zmdi","zmdi-save","zmdi-hc-lg","mr-2"],[1,"zmdi","zmdi-spinner","zmdi-hc-spin","zmdi-hc-lg"],["placeholder","Direcci\xf3n",1,"clients-select",3,"disabled","ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["placeholder","Selecciona una fecha",1,"head-item","my-3",3,"presetDate"],[1,"align-middle","small-width",2,"max-width","50px !important"],[1,"d-flex","align-items-center","justify-content-center"],[1,"zmdi","zmdi-close-circle","zmdi-hc-lg","clickeable","mr-3",3,"click"],[1,"align-middle",2,"width","150px","max-width","100%"],["bindLabel","name","placeholder","Productos",1,"",3,"items","disabled","ngModel","change","ngModelChange"],[1,"align-middle","medium-width"],[1,"input-container"],["placeholder","Piezas","type","text",1,"form-control","no-icon",3,"disabled","ngModel","input","ngModelChange"],["placeholder","Kilogramos","type","text",1,"form-control","no-icon",3,"disabled","ngModel","input","ngModelChange"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e.TgZ(3,"i",3),e.NdJ("click",function(){return n.GoBack()}),e.qZA(),e._uU(4," Crear orden de venta "),e.qZA(),e.TgZ(5,"div",4),e.TgZ(6,"button",5),e.NdJ("click",function(){return n.SaveOrder()}),e.YNc(7,T,3,0,"ng-container",6),e.YNc(8,A,2,0,"ng-container",6),e.qZA(),e.qZA(),e.qZA(),e.TgZ(9,"div",7),e.TgZ(10,"div",8),e.TgZ(11,"ng-select",9),e.NdJ("change",function(o){return n.OnClientSelected(o)})("ngModelChange",function(o){return n.selectedClient=o}),e.qZA(),e.qZA(),e.TgZ(12,"div",8),e.YNc(13,M,2,3,"ng-select",10),e.qZA(),e.YNc(14,b,1,1,"app-date-picker",11),e.qZA(),e.TgZ(15,"div",12),e.TgZ(16,"table",13),e.TgZ(17,"thead",14),e.TgZ(18,"tr"),e.TgZ(19,"th",15),e._uU(20,"#"),e.qZA(),e.TgZ(21,"th",16),e._uU(22,"Producto"),e.qZA(),e.TgZ(23,"th",16),e._uU(24,"Cantidad Pz"),e.qZA(),e.TgZ(25,"th",16),e._uU(26,"Cantidad Kg"),e.qZA(),e.TgZ(27,"th",16),e._uU(28,"Impuesto"),e.qZA(),e.TgZ(29,"th",16),e._uU(30,"Precio"),e.qZA(),e.TgZ(31,"th",16),e._uU(32,"Total"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(33,"tbody"),e.YNc(34,v,22,20,"tr",17),e.TgZ(35,"tr"),e.TgZ(36,"td",18),e.TgZ(37,"button",19),e.NdJ("click",function(){return n.PushItem()}),e._UZ(38,"i",20),e._uU(39," Agregar "),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(40,"div",21),e.TgZ(41,"div",22),e.TgZ(42,"div",23),e.TgZ(43,"div",24),e.TgZ(44,"span",25),e._uU(45,"Subtotal"),e.qZA(),e.TgZ(46,"span"),e._uU(47),e.ALo(48,"number"),e.qZA(),e.qZA(),e.TgZ(49,"div",24),e.TgZ(50,"span",25),e._uU(51,"Impuesto"),e.qZA(),e.TgZ(52,"span"),e._uU(53),e.ALo(54,"number"),e.qZA(),e.qZA(),e.TgZ(55,"div",24),e.TgZ(56,"span",25),e._uU(57,"Total"),e.qZA(),e.TgZ(58,"span"),e._uU(59),e.ALo(60,"number"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.xp6(6),e.Q6J("disabled",n.loading.creating),e.xp6(1),e.Q6J("ngIf",!n.loading.creating),e.xp6(1),e.Q6J("ngIf",n.loading.creating),e.xp6(3),e.Q6J("items",n.clients)("ngModel",n.selectedClient),e.xp6(2),e.Q6J("ngIf",!!n.selectedClient),e.xp6(1),e.Q6J("ngIf",!!n.orderDate),e.xp6(20),e.Q6J("ngForOf",n.orderItems),e.xp6(13),e.hij("$",e.xi3(48,11,n.orderSubtotal,"0.2-2"),""),e.xp6(6),e.hij("$",e.xi3(54,14,n.orderTaxes,"0.2-2"),""),e.xp6(6),e.hij("$",e.xi3(60,17,n.orderTotal,"0.2-2"),""))},directives:[c.O5,g.w9,a.JJ,a.On,c.sg,g.xv,x.L,a.Fj],pipes:[c.JJ],styles:[".clients-select[_ngcontent-%COMP%]{width:100%}.head-row[_ngcontent-%COMP%]{display:flex;align-items:center;grid-gap:24px;gap:24px}.head-item[_ngcontent-%COMP%]{flex-grow:1;flex-basis:33%}.small-width[_ngcontent-%COMP%]{max-width:70px}.medium-width[_ngcontent-%COMP%]{min-width:120px}table[_ngcontent-%COMP%]{overflow-y:visible!important}.order-summary[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;margin:1rem 0}.summary-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;color:#000;font-size:1.25rem}.order-summary[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{width:400px;max-width:100%}"]}),i})()}];let q=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[a.u5,c.ez,g.A0,m.I,a.UX,p.Bz.forChild(y)]]}),i})()}}]);