"use strict";(self.webpackChunkfront=self.webpackChunkfront||[]).push([[593],{3593:(y,g,o)=>{o.r(g),o.d(g,{CreateSellOrderModule:()=>v});var c=o(6019),m=o(850),d=o(7537),u=o(1435),p=o(7591),h=o(4684),C=o(8260),e=o(1514),Z=o(7754),f=o(6588),x=o(6155),_=o(7788);function T(i,s){1&i&&(e.ynx(0),e._UZ(1,"i",25),e._uU(2," Guardar "),e.BQk())}function A(i,s){1&i&&(e.ynx(0),e._UZ(1,"i",26),e.BQk())}function O(i,s){if(1&i&&e._UZ(0,"app-date-picker",27),2&i){const t=e.oxw();e.Q6J("presetDate",t.orderDate.format("YYYY/MM/DD"))}}function b(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"tr"),e.TgZ(1,"td",28),e.TgZ(2,"div",29),e.TgZ(3,"i",30),e.NdJ("click",function(){const l=e.CHM(t).index;return e.oxw().RemoveItem(l)}),e.qZA(),e._uU(4),e.qZA(),e.qZA(),e.TgZ(5,"td",31),e.TgZ(6,"ng-select",32),e.NdJ("change",function(){const l=e.CHM(t).$implicit;return e.oxw().OnWeightOrQuantityChange(l)})("ngModelChange",function(n){return e.CHM(t).$implicit.product=n}),e.qZA(),e.qZA(),e.TgZ(7,"td",33),e.TgZ(8,"div",34),e.TgZ(9,"input",35),e.NdJ("input",function(){const l=e.CHM(t).$implicit;return e.oxw().OnWeightOrQuantityChange(l)})("ngModelChange",function(n){return e.CHM(t).$implicit.quantity=n}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(10,"td",33),e.TgZ(11,"div",34),e.TgZ(12,"input",36),e.NdJ("input",function(){const l=e.CHM(t).$implicit;return e.oxw().OnWeightOrQuantityChange(l)})("ngModelChange",function(n){return e.CHM(t).$implicit.weight=n}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(13,"td",33),e._uU(14),e.ALo(15,"number"),e.qZA(),e.TgZ(16,"td",33),e._uU(17),e.ALo(18,"number"),e.qZA(),e.TgZ(19,"td",33),e._uU(20),e.ALo(21,"number"),e.qZA(),e.qZA()}if(2&i){const t=s.$implicit,r=s.index,n=e.oxw();e.xp6(4),e.hij(" ",r+1," "),e.xp6(2),e.Q6J("items",n.products)("disabled",!n.selectedClient)("ngModel",t.product),e.xp6(3),e.Q6J("disabled",!n.selectedClient)("ngModel",t.quantity),e.xp6(3),e.Q6J("disabled",!n.selectedClient)("ngModel",t.weight),e.xp6(2),e.hij(" $",e.xi3(15,11,t.tax,"0.2-2")," "),e.xp6(3),e.hij(" $",e.xi3(18,14,t.price,"0.2-2")," "),e.xp6(3),e.hij(" $",e.xi3(21,17,t.total,"0.2-2")," ")}}const M=[{path:"",component:(()=>{class i{constructor(t,r,n){this.http=t,this.toast=r,this.nav=n,this.IVA=.16,this.clients=[],this.selectedClient=null,this.measurementTypes=[],this.products=[],this.orderItems=[],this.orderItem={product:null,quantity:null,weight:null,tax:0,price:0,total:0},this.orderDate=h().tz(C.N.timezone).add(4,"hours"),this.loading={getting:!1,creating:!1}}get orderSubtotal(){let t=0;return this.orderItems.forEach(r=>{r.price&&(t+=r.price)}),t}get orderTaxes(){let t=0;return this.orderItems.forEach(r=>{r.tax&&(t+=r.tax)}),t}get orderTotal(){let t=0;return this.orderItems.forEach(r=>{r.total&&(t+=r.total)}),t}ngOnInit(){this.GetClients(),this.GetProducts(),this.PushItem()}GoBack(){this.nav.GoToRoleRoute("sell-orders")}GetMeasurementTypes(){this.http.Get("MeasurementTypes").subscribe(t=>{this.measurementTypes=t},t=>{console.error("Error getting measurement types",t)})}GetProducts(){this.http.Get(`Products/WithPriceHistory/FilteredBy/Text/*/StartDate/${this.orderDate.format("YYYY-MM-DD")}/EndDate/${this.orderDate.format("YYYY-MM-DD")}`).subscribe(t=>{this.products=t},t=>{console.error("Error getting products",t)})}GetClients(){this.http.Get("/Clients").subscribe(r=>{this.clients=r},r=>{console.error("Error getting clients",r)})}PushItem(){this.orderItems.push(Object.assign({},this.orderItem))}RemoveItem(t){this.orderItems.length>1&&this.orderItems.splice(t,1)}OnWeightOrQuantityChange(t){if(t.product){const r=t.product.prices.length?t.product.prices[0].salePrice:t.product.price;let n=0;if(n="pz"===t.product.salesMeasurementType.abrev?t.quantity?t.quantity:0:t.weight?t.weight:0,!Number.isNaN(Number(n))){const l=r*Number(this.selectedClient.utilityPercentage)/100;t.price=Number(n)*(r+l),t.tax=t.price*this.IVA,t.total=t.price+t.tax}}}SaveOrder(){let t=this.ValidateOrderData();if(t)return void this.toast.ShowDefaultWarning(t,"La orden no es valida");let r={date:this.orderDate.toISOString(),items:this.orderItems,subtotal:this.orderSubtotal,taxes:this.orderTaxes,total:this.orderTotal,client:this.selectedClient};this.http.Post("Orders",{order:r}).subscribe(n=>{this.toast.ShowDefaultSuccess("Orden creada exitosamente"),this.nav.GoToRoleRoute("sell-orders")},n=>{console.error("Error creating order",n)})}ValidateOrderData(){let t=null;return this.selectedClient?(this.orderItems.forEach((r,n)=>{if(!r.product)return t=`La fila ${n+1} no tiene producto seleccionado`}),t):"No ha seleccionado cliente"}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Z.O),e.Y36(f.k),e.Y36(x.f))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-create-sell-order"]],decls:59,vars:19,consts:[[1,"content","d-flex","flex-column"],[1,"d-flex","align-items-center","justify-content-between"],[1,"page-title"],[1,"zmdi","zmdi-arrow-back","zmdi-hc-lg","mr-2","clickeable",3,"click"],[1,"d-flex"],[1,"btn","btn-success","mx-1",3,"disabled","click"],[4,"ngIf"],[1,"d-flex","align-items-center","justify-content-between","flex-wrap"],[1,"flex-50-item","form-group","my-3"],["bindLabel","name","placeholder","Clientes",1,"clients-select",3,"items","ngModel","ngModelChange"],["class","flex-50-item my-3","placeholder","Selecciona una fecha",3,"presetDate",4,"ngIf"],[1,"flex-grow-1","overflow-auto"],[1,"table"],[1,"position-sticky",2,"top","0","z-index","1"],[1,"small-width"],[1,"medium-width"],[4,"ngFor","ngForOf"],["colspan","7",1,"px-0"],[1,"btn","btn-outline-success","btn-block","d-flex","align-items-center","justify-content-center",3,"click"],[1,"zmdi","zmdi-plus","zmdi-hc-lg","mr-2"],[1,"order-summary"],[1,"card"],[1,"d-flex","flex-column"],[1,"summary-row"],[2,"font-weight","600"],[1,"zmdi","zmdi-save","zmdi-hc-lg","mr-2"],[1,"zmdi","zmdi-spinner","zmdi-hc-spin","zmdi-hc-lg"],["placeholder","Selecciona una fecha",1,"flex-50-item","my-3",3,"presetDate"],[1,"align-middle","small-width",2,"max-width","50px !important"],[1,"d-flex","align-items-center","justify-content-center"],[1,"zmdi","zmdi-close-circle","zmdi-hc-lg","clickeable","mr-3",3,"click"],[1,"align-middle",2,"width","150px","max-width","100%"],["bindLabel","name","placeholder","Productos",1,"",3,"items","disabled","ngModel","change","ngModelChange"],[1,"align-middle","medium-width"],[1,"input-container"],["placeholder","Piezas","type","text",1,"form-control","no-icon",3,"disabled","ngModel","input","ngModelChange"],["placeholder","Kilogramos","type","text",1,"form-control","no-icon",3,"disabled","ngModel","input","ngModelChange"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e.TgZ(3,"i",3),e.NdJ("click",function(){return r.GoBack()}),e.qZA(),e._uU(4," Crear orden de venta "),e.qZA(),e.TgZ(5,"div",4),e.TgZ(6,"button",5),e.NdJ("click",function(){return r.SaveOrder()}),e.YNc(7,T,3,0,"ng-container",6),e.YNc(8,A,2,0,"ng-container",6),e.qZA(),e.qZA(),e.qZA(),e.TgZ(9,"div",7),e.TgZ(10,"div",8),e.TgZ(11,"ng-select",9),e.NdJ("ngModelChange",function(l){return r.selectedClient=l}),e.qZA(),e.qZA(),e.YNc(12,O,1,1,"app-date-picker",10),e.qZA(),e.TgZ(13,"div",11),e.TgZ(14,"table",12),e.TgZ(15,"thead",13),e.TgZ(16,"tr"),e.TgZ(17,"th",14),e._uU(18,"#"),e.qZA(),e.TgZ(19,"th",15),e._uU(20,"Producto"),e.qZA(),e.TgZ(21,"th",15),e._uU(22,"Cantidad Pz"),e.qZA(),e.TgZ(23,"th",15),e._uU(24,"Cantidad Kg"),e.qZA(),e.TgZ(25,"th",15),e._uU(26,"Impuesto"),e.qZA(),e.TgZ(27,"th",15),e._uU(28,"Precio"),e.qZA(),e.TgZ(29,"th",15),e._uU(30,"Total"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(31,"tbody"),e.YNc(32,b,22,20,"tr",16),e.TgZ(33,"tr"),e.TgZ(34,"td",17),e.TgZ(35,"button",18),e.NdJ("click",function(){return r.PushItem()}),e._UZ(36,"i",19),e._uU(37," Agregar "),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(38,"div",20),e.TgZ(39,"div",21),e.TgZ(40,"div",22),e.TgZ(41,"div",23),e.TgZ(42,"span",24),e._uU(43,"Subtotal"),e.qZA(),e.TgZ(44,"span"),e._uU(45),e.ALo(46,"number"),e.qZA(),e.qZA(),e.TgZ(47,"div",23),e.TgZ(48,"span",24),e._uU(49,"Impuesto"),e.qZA(),e.TgZ(50,"span"),e._uU(51),e.ALo(52,"number"),e.qZA(),e.qZA(),e.TgZ(53,"div",23),e.TgZ(54,"span",24),e._uU(55,"Total"),e.qZA(),e.TgZ(56,"span"),e._uU(57),e.ALo(58,"number"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.xp6(6),e.Q6J("disabled",r.loading.creating),e.xp6(1),e.Q6J("ngIf",!r.loading.creating),e.xp6(1),e.Q6J("ngIf",r.loading.creating),e.xp6(3),e.Q6J("items",r.clients)("ngModel",r.selectedClient),e.xp6(1),e.Q6J("ngIf",!!r.orderDate),e.xp6(20),e.Q6J("ngForOf",r.orderItems),e.xp6(13),e.hij("$",e.xi3(46,10,r.orderSubtotal,"0.2-2"),""),e.xp6(6),e.hij("$",e.xi3(52,13,r.orderTaxes,"0.2-2"),""),e.xp6(6),e.hij("$",e.xi3(58,16,r.orderTotal,"0.2-2"),""))},directives:[c.O5,u.w9,d.JJ,d.On,c.sg,_.L,d.Fj],pipes:[c.JJ],styles:[".clients-select[_ngcontent-%COMP%]{width:100%}.flex-50-item[_ngcontent-%COMP%]{width:40%!important;min-width:250px;max-width:100%}.small-width[_ngcontent-%COMP%]{max-width:70px}.medium-width[_ngcontent-%COMP%]{min-width:120px}table[_ngcontent-%COMP%]{overflow-y:visible!important}.order-summary[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;margin:1rem 0}.summary-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;color:#000;font-size:1.25rem}.order-summary[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{width:400px;max-width:100%}"]}),i})()}];let v=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[d.u5,c.ez,u.A0,p.I,d.UX,m.Bz.forChild(M)]]}),i})()}}]);