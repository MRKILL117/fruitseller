"use strict";(self.webpackChunkfront=self.webpackChunkfront||[]).push([[269],{269:(V,Z,s)=>{s.r(Z),s.d(Z,{SellOrdersModule:()=>B});var g=s(6019),x=s(3697),a=s(7537),A=s(1435),O=s(3550),h=s(4684),f=s(5838),b=s(8260),e=s(1514),C=s(822),q=s(9853),S=s(6588),w=s(6845),U=s(1843),y=s(6155),k=s(5749),T=s(1105);function I(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"i",39),e.NdJ("click",function(){e.CHM(t);const r=e.oxw().$implicit;return e.oxw(3).DownloadOrderResume(r)}),e.qZA()}if(2&n){const t=e.oxw().$implicit,l=e.oxw(3);e.Q6J("isDisabled",!!l.loading.generating&&l.loading.generating!=t.id)}}function z(n,o){1&n&&e._UZ(0,"i",40)}function N(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"button",41),e.NdJ("click",function(){e.CHM(t);const r=e.oxw().$implicit;return e.oxw(3).SetAsDelivered(r)}),e._uU(1," Entregar "),e.qZA()}}function F(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"tr"),e.TgZ(1,"td",30),e.NdJ("click",function(){const i=e.CHM(t).$implicit;return e.oxw(3).nav.GoToRoleRoute("edit-sell-orders/"+i.id)}),e._uU(2),e.qZA(),e.TgZ(3,"td",31),e._uU(4),e.qZA(),e.TgZ(5,"td",31),e._uU(6),e.ALo(7,"date"),e.qZA(),e.TgZ(8,"td",31),e._uU(9),e.qZA(),e.TgZ(10,"td",31),e._uU(11),e.qZA(),e.TgZ(12,"td",31),e._uU(13),e.qZA(),e.TgZ(14,"td",31),e._uU(15),e.qZA(),e.TgZ(16,"td",31),e.TgZ(17,"div",32),e.TgZ(18,"div",33),e.YNc(19,I,1,1,"i",34),e.YNc(20,z,1,0,"i",35),e.TgZ(21,"i",36),e.NdJ("click",function(){const i=e.CHM(t).$implicit;return e.oxw(3).nav.GoToRoleRoute("edit-sell-orders/"+i.id)}),e.qZA(),e.TgZ(22,"i",37),e.NdJ("click",function(){const i=e.CHM(t).$implicit,d=e.oxw(3),c=e.MAs(38);return d.selectedOrder=i,d.modal.OpenModal(c)}),e.qZA(),e.qZA(),e.YNc(23,N,2,0,"button",38),e.qZA(),e.qZA(),e.qZA()}if(2&n){const t=o.$implicit,l=e.oxw(3);e.xp6(2),e.Oqu(t.id),e.xp6(2),e.Oqu(t.status.name),e.xp6(2),e.Oqu(e.xi3(7,10,t.date,"dd/MM/YYYY hh:mm a")),e.xp6(3),e.Oqu(t.client.name),e.xp6(2),e.hij("$",t.taxes,""),e.xp6(2),e.hij("$",t.subtotal,""),e.xp6(2),e.hij("$",t.total,""),e.xp6(4),e.Q6J("ngIf",!l.loading.generating||l.loading.generating!=t.id),e.xp6(1),e.Q6J("ngIf",!!l.loading.generating&&l.loading.generating==t.id),e.xp6(3),e.Q6J("ngIf",1==t.statusId)}}function M(n,o){if(1&n&&(e.TgZ(0,"table",27),e.TgZ(1,"thead",28),e.TgZ(2,"tr"),e.TgZ(3,"th"),e._uU(4,"#"),e.qZA(),e.TgZ(5,"th"),e._uU(6,"Estatus"),e.qZA(),e.TgZ(7,"th"),e._uU(8,"Fecha"),e.qZA(),e.TgZ(9,"th"),e._uU(10,"Cliente"),e.qZA(),e.TgZ(11,"th"),e._uU(12,"Impuestos"),e.qZA(),e.TgZ(13,"th"),e._uU(14,"Subtotal"),e.qZA(),e.TgZ(15,"th"),e._uU(16,"Total"),e.qZA(),e._UZ(17,"th"),e.qZA(),e.qZA(),e.TgZ(18,"tbody"),e.YNc(19,F,24,13,"tr",29),e.qZA(),e.qZA()),2&n){const t=e.oxw(2);e.xp6(19),e.Q6J("ngForOf",t.orders)}}function D(n,o){if(1&n&&(e.TgZ(0,"div",25),e.YNc(1,M,20,1,"table",26),e.qZA()),2&n){const t=e.oxw(),l=e.MAs(34);e.xp6(1),e.Q6J("ngIf",!(null==t.orders||!t.orders.length))("ngIfElse",l)}}function J(n,o){1&n&&(e.TgZ(0,"div",42),e._UZ(1,"i",43),e.qZA())}function E(n,o){1&n&&(e.TgZ(0,"div",44),e._uU(1," No tiene ordenes registrados "),e.qZA())}function Y(n,o){if(1&n&&(e.TgZ(0,"tr"),e.TgZ(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.qZA()),2&n){const t=o.$implicit;e.xp6(2),e.Oqu(t.order.orderId),e.xp6(2),e.Oqu(t.order.clientRfcOrId),e.xp6(2),e.Oqu(t.order.productNameOrId),e.xp6(2),e.Oqu(t.reason?t.reason:"Error al crear")}}function R(n,o){if(1&n&&(e.TgZ(0,"div",58),e.TgZ(1,"div",59),e._uU(2," Error al crear ordenes "),e.qZA(),e.TgZ(3,"table",60),e.TgZ(4,"thead",61),e.TgZ(5,"tr"),e.TgZ(6,"th"),e._uU(7,"No. orden"),e.qZA(),e.TgZ(8,"th"),e._uU(9,"Cliente"),e.qZA(),e.TgZ(10,"th"),e._uU(11,"Producto"),e.qZA(),e.TgZ(12,"th"),e._uU(13,"Motivo"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(14,"tbody"),e.YNc(15,Y,9,4,"tr",29),e.qZA(),e.qZA(),e.qZA()),2&n){const t=e.oxw(2);e.xp6(15),e.Q6J("ngForOf",t.ordersFailed)}}function $(n,o){1&n&&(e.TgZ(0,"span"),e._uU(1,"Cancelar"),e.qZA())}function G(n,o){1&n&&(e.TgZ(0,"span"),e._uU(1,"Cerrar"),e.qZA())}function Q(n,o){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Oqu(t.csvAcceptLabel)}}function H(n,o){1&n&&(e.TgZ(0,"span"),e._UZ(1,"i",40),e.qZA())}function K(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",45),e.TgZ(1,"h2",46),e._uU(2,"Agregar por CSV"),e.qZA(),e.TgZ(3,"i",47),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return r.modal.CloseModal(r.loading.updating)}),e.qZA(),e.qZA(),e.TgZ(4,"div",48),e.TgZ(5,"div",49),e.TgZ(6,"div",1),e.TgZ(7,"button",50),e.NdJ("click",function(){return e.CHM(t),e.MAs(12).click()}),e._uU(8," Seleccionar archivo "),e.qZA(),e.TgZ(9,"span"),e._uU(10),e.qZA(),e.TgZ(11,"input",51,52),e.NdJ("change",function(r){return e.CHM(t),e.oxw().OnFileSelected(r)}),e.qZA(),e.qZA(),e.YNc(13,R,16,1,"div",53),e.qZA(),e.qZA(),e.TgZ(14,"div",54),e.TgZ(15,"button",55),e.NdJ("click",function(){return e.CHM(t),e.oxw().modal.CloseModal()}),e.YNc(16,$,2,0,"span",56),e.YNc(17,G,2,0,"span",56),e.qZA(),e.TgZ(18,"button",57),e.NdJ("click",function(){return e.CHM(t),e.oxw().RegisterOrders()}),e.YNc(19,Q,2,1,"span",56),e.YNc(20,H,2,0,"span",56),e.qZA(),e.qZA()}if(2&n){const t=e.oxw();e.xp6(10),e.hij(" ",null==t.ordersCsv?null:t.ordersCsv.name," "),e.xp6(3),e.Q6J("ngIf",!(null==t.ordersFailed||!t.ordersFailed.length)),e.xp6(3),e.Q6J("ngIf",!(null!=t.ordersFailed&&t.ordersFailed.length)),e.xp6(1),e.Q6J("ngIf",!(null==t.ordersFailed||!t.ordersFailed.length)),e.xp6(1),e.Q6J("disabled",t.loading.updating),e.xp6(1),e.Q6J("ngIf",!t.loading.updating),e.xp6(1),e.Q6J("ngIf",t.loading.updating)}}function j(n,o){1&n&&(e.TgZ(0,"span"),e._uU(1,"Si, eliminar"),e.qZA())}function P(n,o){1&n&&(e.TgZ(0,"span"),e._UZ(1,"i",40),e.qZA())}function L(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",45),e.TgZ(1,"h2",46),e._uU(2,"Eliminar orden"),e.qZA(),e.TgZ(3,"i",47),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return r.modal.CloseModal(r.loading.updating)}),e.qZA(),e.qZA(),e.TgZ(4,"div",48),e.TgZ(5,"div",4),e._uU(6),e.qZA(),e.qZA(),e.TgZ(7,"div",54),e.TgZ(8,"button",62),e.NdJ("click",function(){return e.CHM(t),e.oxw().modal.CloseModal()}),e._uU(9," No, cancelar "),e.qZA(),e.TgZ(10,"button",63),e.NdJ("click",function(){return e.CHM(t),e.oxw().DeleteOrder()}),e.YNc(11,j,2,0,"span",56),e.YNc(12,P,2,0,"span",56),e.qZA(),e.qZA()}if(2&n){const t=e.oxw();e.xp6(6),e.hij(" \xbfEsta seguro que desea eliminar la orden No. ",null==t.selectedOrder?null:t.selectedOrder.id,"? "),e.xp6(2),e.Q6J("disabled",t.loading.updating),e.xp6(2),e.Q6J("disabled",t.loading.updating),e.xp6(1),e.Q6J("ngIf",!t.loading.updating),e.xp6(1),e.Q6J("ngIf",t.loading.updating)}}const W=[{path:"",component:(()=>{class n{constructor(t,l,r,i,d,c){this.form=t,this.modal=l,this.toast=r,this.http=i,this.csv=d,this.nav=c,this.measurementTypes=[],this.orders=[],this.selectedOrder=null,this.isEditing=!1,this.ordersToUpload=[],this.ordersFailed=[],this.filters=[],this.loading={updating:!1,getting:!0},this.orderForm=new a.cw({id:new a.NI(null,[]),name:new a.NI("",[a.kI.required]),price:new a.NI("",[a.kI.required,(0,f.AW)()]),tax:new a.NI("",[a.kI.required,(0,f.wp)()]),buyerId:new a.NI(null,[a.kI.required]),salesMeasurementTypeId:new a.NI(null,[a.kI.required]),inventoryMeasurementTypeId:new a.NI(null,[a.kI.required])}),this.dataConversions=[{oldKey:"No. Orden",newKey:"orderId"},{oldKey:"Cliente",newKey:"clientRfcOrId"},{oldKey:"Direcci\xf3n",newKey:"addressAliasOrId"},{oldKey:"Fecha",newKey:"date"},{oldKey:"Producto",newKey:"productNameOrId"},{oldKey:"Piezas",newKey:"quantity",type:"number"},{oldKey:"Kilos",newKey:"weight",type:"number"}],this.InitializeFilters()}get csvAcceptLabel(){return this.ordersFailed.length?"Reintentar":"Subir"}ngOnInit(){this.GetOrders()}InitializeFilters(){this.filters.push({type:"datepicker",name:"startDate",placeholder:"Fecha de inicio",config:null}),this.filters.push({type:"datepicker",name:"endDate",placeholder:"Fecha de fin",config:null})}GoHome(){this.nav.GoToRoleRoute("")}FormatDate(t){return t&&"*"!=t?h(t).tz(b.N.timezone).toISOString().split("T").shift():"*"}OnSalesMeasurementTypeChanges(t){var l,r;t&&!(null===(l=this.orderForm.get("inventoryMeasurementTypeId"))||void 0===l?void 0:l.value)&&(null===(r=this.orderForm.get("inventoryMeasurementTypeId"))||void 0===r||r.setValue(t.id))}GetOrders(t=null){this.loading.getting=!0;let l="/Orders";t&&(l+=`/FilteredBy/StartDate/${this.FormatDate(t.startDate)}/EndDate/${this.FormatDate(t.endDate)}`),this.http.Get(l).subscribe(r=>{this.orders=r,this.loading.getting=!1},r=>{console.error("Error getting Orders",r),this.loading.getting=!1})}RegisterOrders(){this.loading.updating=!0,this.http.Post("Orders/Array",{products:this.ordersToUpload}).subscribe(t=>{this.GetOrders(),this.ordersFailed=t.ordersFailed,t.ordersSuccess.length&&this.toast.ShowDefaultSuccess("Ordenes creados correctamente"),t.ordersFailed.length?this.toast.ShowDefaultWarning("Algunas ordenes no se pudieron crear"):(this.modal.CloseModal(),this.ordersToUpload=[]),this.loading.updating=!1},t=>{console.error("Error creating Orders",t),this.toast.ShowDefaultDanger("Error al crear ordenes"),this.loading.updating=!1})}DeleteOrder(){this.loading.updating=!0,this.http.Delete(`Orders/${this.selectedOrder.id}`,{}).subscribe(t=>{this.GetOrders(),this.toast.ShowDefaultSuccess("Orden eliminado correctamente"),this.modal.CloseModal(),this.loading.updating=!1},t=>{console.error("Error deleting Order",t),this.toast.ShowDefaultDanger(t||"Error al eliminar orden"),this.loading.updating=!1})}SetAsDelivered(t){this.http.Patch(`/Orders/${t.id}/Deliver`,{}).subscribe(l=>{this.toast.ShowDefaultSuccess("Orden actualizada"),this.GetOrders()},l=>{this.toast.ShowDefaultDanger(l||"Error al actualizar orden"),console.error("Error delivering order",l)})}DownloadTemplate(){this.http.DownloadFileWithoutApi("assets/templates/plantilla_ordenes.csv","plantilla_ordenes.csv")}OnFileSelected(t){const l=t.target.files[0];if(this.ordersCsv=l,!l)return;const r=new FileReader;r.onload=i=>{this.csv.ReadCSV(r.result).then(d=>{this.ordersToUpload=this.csv.FormatData(d.data,this.dataConversions)})},r.readAsText(l,"ISO-8859-3")}GenerateClientAddress(t){return t?t.street+" #"+t.externalNumber+(t.internalNumber?" int. "+t.internalNumber:""):""}GenerateCsv(){let r=[];this.orders.forEach(i=>{var d;(null===(d=i.items)||void 0===d?void 0:d.length)&&i.items.forEach(c=>{var _,u,p,m;let v=null;v={id:i.id,status:null===(_=i.status)||void 0===_?void 0:_.name,date:h(i.date).format("DD/MM/YYYY"),client:null===(u=i.client)||void 0===u?void 0:u.name,address:this.GenerateClientAddress(i.address),product:(null===(p=c.product)||void 0===p?void 0:p.name)?null===(m=c.product)||void 0===m?void 0:m.name:"Sin producto",quantity:`${c.quantity?c.quantity:0}`,weight:`${c.weight?c.weight:0}`,taxes:`$${i.taxes}`,subtotal:`$${i.subtotal}`,total:`$${i.total}`},r.push(v)})}),this.csv.GenerateCSV("ordenes_de_venta",r,["id","status","date","client","address","product","quantity","weight"],["id","Estado","Fecha","Cliente","Direccion","Producto","Piezas","Kilos"])}DownloadOrderResume(t){this.loading.generating||(this.loading.generating=t.id,this.http.GetFile(`/Orders/${t.id}/Resume`).subscribe(l=>{const r=new Blob([l],{type:"application/pdf"}),i=window.URL.createObjectURL(r),d=document.createElement("a");d.href=i,d.download=`ficha_orden_${t.id}`,document.body.appendChild(d),d.click(),window.URL.revokeObjectURL(i),this.loading.generating=null},l=>{console.error("Error generating order pdf",l),this.toast.ShowDefaultDanger("Error al generar PDF"),this.loading.generating=null}))}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(C.o),e.Y36(q.Z),e.Y36(S.k),e.Y36(w.O),e.Y36(U.M),e.Y36(y.f))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-sell-orders"]],decls:39,vars:4,consts:[[1,"content"],[1,"d-flex","align-items-center","justify-content-between"],[1,"page-title"],[1,"zmdi","zmdi-home","zmdi-hc-lg","mr-2","clickeable",3,"click"],[1,"d-flex"],[1,"btn","btn-success","mx-1",3,"click"],[1,"zmdi","zmdi-plus-circle-o","zmdi-hc-lg","mr-2"],["id","csvordersDropdown","data-toggle","dropdown","aria-haspopup","true","aria-expanded","false",1,"clickeable","px-2"],[1,"btn","btn-success","mx-1"],[1,"zmdi","zmdi-file","zmdi-hc-lg","mr-2"],["aria-labelledby","csvordersDropdown",1,"dropdown-menu","px-1","py-1"],[1,"menu-list"],[1,"d-flex","align-items-center","px-3","my-1","clickeable-hover",3,"click"],[1,"zmdi","zmdi-file-text"],[1,"pl-2"],[1,"zmdi","zmdi-file-plus"],[1,"zmdi","zmdi-download"],[1,"row","justify-content-center"],[1,"col-12","mb-4"],[3,"timerTrigger","filters","onSearch"],["class","col-12 col-lg-11",4,"ngIf","ngIfElse"],["bigLoading",""],["noOrdersMessage",""],["addOrdersByCsvModal",""],["deleteorderModal",""],[1,"col-12","col-lg-11"],["class","table table-striped",4,"ngIf","ngIfElse"],[1,"table","table-striped"],[1,"table-thead"],[4,"ngFor","ngForOf"],[1,"align-middle","clickeable",3,"click"],[1,"align-middle"],[1,"d-flex","flex-column",2,"gap","12px"],[1,"d-flex","align-items-center","justify-content-center",2,"gap","12px"],["class","zmdi zmdi-case-download zmdi-hc-lg clickeable","tooltip","Generar PDF",3,"isDisabled","click",4,"ngIf"],["class","zmdi zmdi-spinner zmdi-hc-lg zmdi-hc-spin",4,"ngIf"],[1,"zmdi","zmdi-edit","zmdi-hc-lg","clickeable",3,"click"],[1,"zmdi","zmdi-delete","zmdi-hc-lg","clickeable",3,"click"],["class","btn btn-primary",3,"click",4,"ngIf"],["tooltip","Generar PDF",1,"zmdi","zmdi-case-download","zmdi-hc-lg","clickeable",3,"isDisabled","click"],[1,"zmdi","zmdi-spinner","zmdi-hc-lg","zmdi-hc-spin"],[1,"btn","btn-primary",3,"click"],[1,"w-100","h-75","d-flex","align-items-center","justify-content-center",2,"min-height","min-content"],[1,"zmdi","zmdi-spinner","zmdi-hc-5x","zmdi-hc-spin"],[1,"no-items-message"],[1,"modal-header"],[1,"modal-title"],[1,"close-modal-button","zmdi","zmdi-close-circle-o","zmdi-hc-2x","clickeable",3,"click"],[1,"modal-body"],[1,"d-flex","flex-column","justify-content-between"],[1,"btn","btn-outline-primary",3,"click"],["type","file","accept",".csv",1,"d-none",3,"change"],["csvFileInput",""],["class","modal-table",4,"ngIf"],[1,"modal-footer"],[1,"btn","btn-secondary",3,"click"],[4,"ngIf"],[1,"btn","btn-success",3,"disabled","click"],[1,"modal-table"],[1,"my-4","text-center",2,"font-size","1.25rem","font-weight","700"],[1,"table","table-danger","table-striped"],[1,"table-thead","bg-danger"],[1,"btn","btn-secondary",3,"disabled","click"],[1,"btn","btn-danger",3,"disabled","click"]],template:function(t,l){if(1&t){const r=e.EpF();e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e.TgZ(3,"i",3),e.NdJ("click",function(){return l.GoHome()}),e.qZA(),e._uU(4," Mis ordenes de venta "),e.qZA(),e.TgZ(5,"div",4),e.TgZ(6,"button",5),e.NdJ("click",function(){return l.nav.GoToRoleRoute("sell-orders/create")}),e._UZ(7,"i",6),e._uU(8," Agregar "),e.qZA(),e.TgZ(9,"div",7),e.TgZ(10,"button",8),e._UZ(11,"i",9),e._uU(12," CSV "),e.qZA(),e.TgZ(13,"div",10),e.TgZ(14,"div",11),e.TgZ(15,"div",12),e.NdJ("click",function(){return l.DownloadTemplate()}),e._UZ(16,"i",13),e.TgZ(17,"span",14),e._uU(18,"Descargar plantilla"),e.qZA(),e.qZA(),e.TgZ(19,"div",12),e.NdJ("click",function(){e.CHM(r);const d=e.MAs(36);return l.modal.OpenModal(d)}),e._UZ(20,"i",15),e.TgZ(21,"span",14),e._uU(22,"Cargar ordenes"),e.qZA(),e.qZA(),e.TgZ(23,"div",12),e.NdJ("click",function(){return l.GenerateCsv()}),e._UZ(24,"i",16),e.TgZ(25,"span",14),e._uU(26,"Exportar ordenes"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(27,"div",17),e.TgZ(28,"div",18),e.TgZ(29,"app-filters",19),e.NdJ("onSearch",function(d){return l.GetOrders(d)}),e.qZA(),e.qZA(),e.YNc(30,D,2,2,"div",20),e.qZA(),e.qZA(),e.YNc(31,J,2,0,"ng-template",null,21,e.W1O),e.YNc(33,E,2,0,"ng-template",null,22,e.W1O),e.YNc(35,K,21,7,"ng-template",null,23,e.W1O),e.YNc(37,L,13,5,"ng-template",null,24,e.W1O)}if(2&t){const r=e.MAs(32);e.xp6(29),e.Q6J("timerTrigger",!0)("filters",l.filters),e.xp6(1),e.Q6J("ngIf",!l.loading.getting)("ngIfElse",r)}},directives:[k.b,g.O5,g.sg,T.i9],pipes:[g.uU],styles:[""]}),n})()}];let B=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[a.u5,g.ez,O.F,A.A0,a.UX,T.z8.forRoot(),x.Bz.forChild(W)]]}),n})()}}]);