"use strict";(self.webpackChunkfront=self.webpackChunkfront||[]).push([[826],{4826:(Y,u,r)=>{r.r(u),r.d(u,{InventoryModule:()=>N});var l=r(6019),g=r(850),c=r(7537),p=r(1435),t=r(1514),h=r(4684),f=r(8260),Z=r(9853),m=r(6588),v=r(7754),T=r(6155),I=r(1843),_=r(5749),C=r(5838),A=r(822);function x(e,s){1&e&&(t.TgZ(0,"span",18),t._uU(1," Campo obligatorio "),t.qZA())}function q(e,s){1&e&&(t.TgZ(0,"span",18),t._uU(1," Valor invalido "),t.qZA())}function F(e,s){if(1&e&&(t.TgZ(0,"div",16),t.YNc(1,x,2,0,"span",17),t.YNc(2,q,2,0,"span",17),t.qZA()),2&e){const o=t.oxw();let n,i;t.xp6(1),t.Q6J("ngIf",null==(n=o.form.GetFormControlByName(o.productInventoryForm,"quantity"))?null:n.errors.required),t.xp6(1),t.Q6J("ngIf",null==(i=o.form.GetFormControlByName(o.productInventoryForm,"quantity"))?null:i.errors.onlynumbers)}}function H(e,s){if(1&e){const o=t.EpF();t.TgZ(0,"div",19),t.TgZ(1,"button",20),t.NdJ("click",function(){return t.CHM(o),t.oxw().Update()}),t._uU(2," Actualizar "),t.qZA(),t.qZA()}}const b=function(e){return{"caret-active":e}};function P(e,s){if(1&e){const o=t.EpF();t.TgZ(0,"div",21),t.NdJ("click",function(){t.CHM(o);const i=t.oxw();return i.showHistory=!i.showHistory}),t._UZ(1,"i",22),t.qZA()}if(2&e){const o=t.oxw();t.xp6(1),t.Q6J("ngClass",t.VKq(1,b,o.showHistory))}}function U(e,s){if(1&e&&(t.TgZ(0,"div",23),t.TgZ(1,"div",14),t._uU(2),t.ALo(3,"date"),t.qZA(),t.TgZ(4,"div",14),t._uU(5),t.qZA(),t.qZA()),2&e){const o=s.$implicit,n=t.oxw();t.xp6(2),t.Oqu(t.xi3(3,2,o.date,"dd/MM/YYYY")),t.xp6(3),t.Oqu(o.quantity+" "+n.product.inventoryMeasurementType.abrev)}}const w=function(e){return{"toggle-active":e}};let y=(()=>{class e{constructor(o,n,i){this.form=o,this.toast=n,this.http=i,this.product=null,this.history=!1,this.toggleHistory=null,this.onUpdate=new t.vpe,this.showHistory=!1,this.productInventoryForm=new c.cw({id:new c.NI("",[c.kI.required]),quantity:new c.NI("",[c.kI.required,(0,C.wp)()])})}ngOnInit(){this.history&&this.productInventoryForm.disable(),this.toggleHistory&&this.toggleHistory.subscribe(o=>{this.history="boolean"==typeof o?o:!this.history,this.history?this.productInventoryForm.disable():this.productInventoryForm.enable()}),this.productInventoryForm.setValue({id:this.product.inventories[0].id,quantity:this.product.inventories[0].quantity})}Update(){if(this.productInventoryForm.invalid)return void this.toast.ShowDefaultWarning("Los valores no son validos");let o=this.productInventoryForm.value;this.http.Patch(`/Inventories/${o.id}`,{inventory:o}).subscribe(n=>{this.toast.ShowDefaultSuccess("Precios actualizados")},n=>{console.error("Error updating prices",n)})}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(A.o),t.Y36(m.k),t.Y36(v.O))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-product-inventory-history"]],inputs:{product:"product",history:"history",toggleHistory:"toggleHistory"},outputs:{onUpdate:"onUpdate"},decls:34,vars:14,consts:[[1,"card","d-flex","flex-column"],[3,"formGroup"],[1,"d-flex","align-items-center","justify-content-around","flex-wrap"],[1,"name","mx-2"],[1,"form-group","mx-2"],[1,"text-center"],[1,"input-container"],[1,"input-icon","zmdi","zmdi-assignment","zmdi-hc-lg"],["type","text","placeholder","Precio de compra","formControlName","quantity",1,"form-control",3,"keyup.enter"],["class","error-messages",4,"ngIf"],["class","mx-2",4,"ngIf"],["class","clickeable",3,"click",4,"ngIf"],[1,"d-flex","flex-column","price-history","position-relative",3,"ngClass"],[1,"div-table","t-header"],[1,"th"],["class","div-table t-body",4,"ngFor","ngForOf"],[1,"error-messages"],["class","d-block",4,"ngIf"],[1,"d-block"],[1,"mx-2"],[1,"btn","btn-success",3,"click"],[1,"clickeable",3,"click"],[1,"zmdi","zmdi-caret-down","zmdi-hc-3x",3,"ngClass"],[1,"div-table","t-body"]],template:function(o,n){if(1&o&&(t.TgZ(0,"div",0),t.TgZ(1,"form",1),t.TgZ(2,"div",2),t.TgZ(3,"div",3),t._uU(4),t.qZA(),t.TgZ(5,"div",4),t.TgZ(6,"label"),t._uU(7," Ultima modificaci\xf3n"),t.qZA(),t.TgZ(8,"div",5),t._uU(9),t.ALo(10,"date"),t.qZA(),t.qZA(),t.TgZ(11,"div",4),t.TgZ(12,"label"),t._uU(13," Inventario"),t.qZA(),t.TgZ(14,"div",6),t._UZ(15,"i",7),t.TgZ(16,"input",8),t.NdJ("keyup.enter",function(){return n.Update()}),t.qZA(),t.qZA(),t.YNc(17,F,3,2,"div",9),t.qZA(),t.TgZ(18,"div",4),t.TgZ(19,"label"),t._uU(20," Unidad de medida"),t.qZA(),t.TgZ(21,"div",5),t._uU(22),t.qZA(),t.qZA(),t.YNc(23,H,3,0,"div",10),t.YNc(24,P,2,3,"div",11),t.qZA(),t.qZA(),t.TgZ(25,"div",12),t.TgZ(26,"div",13),t.TgZ(27,"div",14),t.TgZ(28,"b"),t._uU(29,"Fecha"),t.qZA(),t.qZA(),t.TgZ(30,"div",14),t.TgZ(31,"b"),t._uU(32,"Inventario"),t.qZA(),t.qZA(),t.qZA(),t.YNc(33,U,6,5,"div",15),t.qZA(),t.qZA()),2&o){let i;t.xp6(1),t.Q6J("formGroup",n.productInventoryForm),t.xp6(3),t.Oqu(null==n.product?null:n.product.name),t.xp6(5),t.hij(" ",t.xi3(10,9,n.product.inventories[0].lastModified,"short")," "),t.xp6(8),t.Q6J("ngIf",(null==(i=n.form.GetFormControlByName(n.productInventoryForm,"quantity"))?null:i.touched)&&(null==(i=n.form.GetFormControlByName(n.productInventoryForm,"quantity"))?null:i.errors)),t.xp6(5),t.hij(" ",n.product.inventoryMeasurementType.abrev," "),t.xp6(1),t.Q6J("ngIf",!n.history),t.xp6(1),t.Q6J("ngIf",n.history),t.xp6(1),t.Q6J("ngClass",t.VKq(12,w,n.showHistory)),t.xp6(8),t.Q6J("ngForOf",null==n.product?null:n.product.inventories)}},directives:[c._Y,c.JL,c.sg,c.Fj,c.JJ,c.u,l.O5,l.mk,l.sg],pipes:[l.uU],styles:[".price-history[_ngcontent-%COMP%]{height:0px;overflow-y:hidden;transition:all .3s ease-in-out;position:relative}.form-group[_ngcontent-%COMP%]{margin:0}.toggle-active[_ngcontent-%COMP%]{margin-top:1.8rem;height:250px;overflow-y:auto}.zmdi-caret-down[_ngcontent-%COMP%]{transition:all .3s ease-in-out}.caret-active[_ngcontent-%COMP%]{transform:rotate(180deg)}.name[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600}.div-table[_ngcontent-%COMP%]{display:flex;align-items:center}.t-header[_ngcontent-%COMP%]{border-radius:12px 12px 0 0!important;background-color:#51a351!important;color:#fff;position:sticky;top:0}.t-body[_ngcontent-%COMP%]{border-top:1px solid #dee2e6}div.price-history[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:nth-of-type(odd){background:#F2F2F2}.th[_ngcontent-%COMP%]{height:50px;width:50%;display:flex;align-items:center;justify-content:center}.sticky-top[_ngcontent-%COMP%]{position:sticky;top:0}"]}),e})();function z(e,s){if(1&e&&(t.TgZ(0,"div",19),t._UZ(1,"app-product-inventory-history",20),t.qZA()),2&e){const o=s.$implicit,n=t.oxw();t.xp6(1),t.Q6J("product",o)("history",n.showingHistory)("toggleHistory",n.onShowHistory)}}let M=(()=>{class e{constructor(o,n,i,a,d){this.modal=o,this.toast=n,this.http=i,this.nav=a,this.csv=d,this.onShowHistory=new t.vpe,this.showingHistory=!1,this.products=[],this.filters=[],this.loading={getting:!1},this.InitializeFilters()}ngOnInit(){this.GetProducts()}InitializeFilters(){this.filters.push({type:"text",name:"text",placeholder:"Buscar"}),this.filters.push({type:"datepicker",name:"startDate",placeholder:"Fecha de inicio",config:null}),this.filters.push({type:"datepicker",name:"endDate",placeholder:"Fecha de fin",config:null})}GoHome(){this.nav.GoToRoleRoute("")}FormatDate(o){return o&&"*"!=o?h(o).tz(f.N.timezone).toISOString().split("T").shift():"*"}GetProducts(o=null){let n="Products/WithInventory";o&&(n+=`/FilteredBy/Text/${o.text}/StartDate/${this.FormatDate(o.startDate)}/EndDate/${this.FormatDate(o.endDate)}`),this.loading.getting=!0,this.http.Get(n).subscribe(i=>{this.products=i,this.loading.getting=!1},i=>{console.error("Error getting products",i),this.loading.getting=!1})}GenerateCsv(){let i=[];this.products.forEach(a=>{i=i.concat(a.inventories.map(d=>({product:a.name,date:d.date,quantity:d.quantity})))}),this.csv.GenerateCSV("inventario",i,["product","date","quantity"],["Producto","Fecha","Inventario"])}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(Z.Z),t.Y36(m.k),t.Y36(v.O),t.Y36(T.f),t.Y36(I.M))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-inventory"]],decls:23,vars:4,consts:[[1,"content"],[1,"d-flex","align-items-center","justify-content-between"],[1,"page-title"],[1,"zmdi","zmdi-home","zmdi-hc-lg","mr-2","clickeable",3,"click"],[1,"d-flex"],[1,"btn","btn-success","mx-1",3,"click"],[1,"zmdi","zmdi-assignment","zmdi-hc-lg","mr-2"],["id","csvBuyersDropdown","data-toggle","dropdown","aria-haspopup","true","aria-expanded","false",1,"clickeable","px-2"],[1,"btn","btn-success","mx-1"],[1,"zmdi","zmdi-file","zmdi-hc-lg","mr-2"],["aria-labelledby","csvBuyersDropdown",1,"dropdown-menu","px-1","py-1"],[1,"menu-list"],[1,"d-flex","align-items-center","px-3","my-1","clickeable-hover",3,"click"],[1,"zmdi","zmdi-download"],[1,"pl-2"],[1,"row"],[1,"col-12","mt-3","mb-4"],[3,"timerTrigger","filters","onSearch"],["class","col-12 my-3",4,"ngFor","ngForOf"],[1,"col-12","my-3"],[3,"product","history","toggleHistory"]],template:function(o,n){1&o&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"div",2),t.TgZ(3,"i",3),t.NdJ("click",function(){return n.GoHome()}),t.qZA(),t._uU(4," Inventario "),t.qZA(),t.TgZ(5,"div",4),t.TgZ(6,"button",5),t.NdJ("click",function(){return n.showingHistory=!n.showingHistory,n.onShowHistory.emit(n.showingHistory)}),t._UZ(7,"i",6),t._uU(8),t.qZA(),t.TgZ(9,"div",7),t.TgZ(10,"button",8),t._UZ(11,"i",9),t._uU(12," CSV "),t.qZA(),t.TgZ(13,"div",10),t.TgZ(14,"div",11),t.TgZ(15,"div",12),t.NdJ("click",function(){return n.GenerateCsv()}),t._UZ(16,"i",13),t.TgZ(17,"span",14),t._uU(18,"Exportar archivo"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(19,"div",15),t.TgZ(20,"div",16),t.TgZ(21,"app-filters",17),t.NdJ("onSearch",function(a){return n.GetProducts(a)}),t.qZA(),t.qZA(),t.YNc(22,z,2,3,"div",18),t.qZA(),t.qZA()),2&o&&(t.xp6(8),t.hij(" ",n.showingHistory?"Actualizar inventario":"Ver historial"," "),t.xp6(13),t.Q6J("timerTrigger",!0)("filters",n.filters),t.xp6(1),t.Q6J("ngForOf",n.products))},directives:[_.b,l.sg,y],styles:[""]}),e})();var k=r(3550);let O=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[c.u5,l.ez,p.A0,c.UX]]}),e})();const J=[{path:"",component:M}];let N=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[c.u5,l.ez,k.F,p.A0,c.UX,O,g.Bz.forChild(J)]]}),e})()}}]);