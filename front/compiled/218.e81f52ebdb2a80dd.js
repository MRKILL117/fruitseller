"use strict";(self.webpackChunkfront=self.webpackChunkfront||[]).push([[218],{1218:(w,u,l)=>{l.r(u),l.d(u,{SellOrderModule:()=>b});var c=l(6019),g=l(850),s=l(7537),h=l(1435),p=l(7591),m=l(4684),t=l(1514),f=l(7754),x=l(6588),Z=l(6155);function _(i,d){1&i&&(t.ynx(0),t._UZ(1,"i",24),t._uU(2," Guardar "),t.BQk())}function T(i,d){1&i&&(t.ynx(0),t._UZ(1,"i",25),t.BQk())}function v(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"tr"),t.TgZ(1,"td",26),t.TgZ(2,"div",27),t._uU(3),t.qZA(),t.qZA(),t.TgZ(4,"td",28),t._uU(5),t.qZA(),t.TgZ(6,"td",29),t.TgZ(7,"div",30),t.TgZ(8,"input",31),t.NdJ("input",function(){const o=t.CHM(e).$implicit;return t.oxw(2).OnWeightOrQuantityChange(o)})("ngModelChange",function(n){return t.CHM(e).$implicit.quantity=n}),t.qZA(),t.qZA(),t.qZA(),t.TgZ(9,"td",29),t.TgZ(10,"div",30),t.TgZ(11,"input",32),t.NdJ("input",function(){const o=t.CHM(e).$implicit;return t.oxw(2).OnWeightOrQuantityChange(o)})("ngModelChange",function(n){return t.CHM(e).$implicit.weight=n}),t.qZA(),t.qZA(),t.qZA(),t.TgZ(12,"td",29),t._uU(13),t.ALo(14,"number"),t.qZA(),t.TgZ(15,"td",29),t._uU(16),t.ALo(17,"number"),t.qZA(),t.TgZ(18,"td",29),t._uU(19),t.ALo(20,"number"),t.qZA(),t.qZA()}if(2&i){const e=d.$implicit,r=d.index;t.xp6(3),t.hij(" ",r+1," "),t.xp6(2),t.hij(" ",null==e.product?null:e.product.name," "),t.xp6(3),t.Q6J("ngModel",e.quantity),t.xp6(3),t.Q6J("ngModel",e.weight),t.xp6(2),t.hij(" $",t.xi3(14,7,e.tax,"0.2-2")," "),t.xp6(3),t.hij(" $",t.xi3(17,10,e.price,"0.2-2")," "),t.xp6(3),t.hij(" $",t.xi3(20,13,e.total,"0.2-2")," ")}}function C(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"div",2),t.TgZ(1,"div",3),t.TgZ(2,"div",4),t.TgZ(3,"i",5),t.NdJ("click",function(){return t.CHM(e),t.oxw().GoBack()}),t.qZA(),t._uU(4),t.qZA(),t.TgZ(5,"div",6),t.TgZ(6,"button",7),t.NdJ("click",function(){return t.CHM(e),t.oxw().SaveOrder()}),t.YNc(7,_,3,0,"ng-container",8),t.YNc(8,T,2,0,"ng-container",8),t.qZA(),t.qZA(),t.qZA(),t.TgZ(9,"div",9),t.TgZ(10,"div",10),t._uU(11),t.qZA(),t.TgZ(12,"div",10),t._uU(13),t.qZA(),t.TgZ(14,"div",11),t.TgZ(15,"ng-select",12),t.NdJ("ngModelChange",function(n){return t.CHM(e),t.oxw().order.statusId=n}),t.qZA(),t.qZA(),t.TgZ(16,"div",10),t._uU(17),t.qZA(),t.qZA(),t.TgZ(18,"div",13),t.TgZ(19,"table",14),t.TgZ(20,"thead",15),t.TgZ(21,"tr"),t.TgZ(22,"th",16),t._uU(23,"#"),t.qZA(),t.TgZ(24,"th",17),t._uU(25,"Producto"),t.qZA(),t.TgZ(26,"th",17),t._uU(27,"Cantidad Pz"),t.qZA(),t.TgZ(28,"th",17),t._uU(29,"Cantidad Kg"),t.qZA(),t.TgZ(30,"th",17),t._uU(31,"Impuesto"),t.qZA(),t.TgZ(32,"th",17),t._uU(33,"Precio"),t.qZA(),t.TgZ(34,"th",17),t._uU(35,"Total"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(36,"tbody"),t.YNc(37,v,21,16,"tr",18),t.qZA(),t.qZA(),t.qZA(),t.TgZ(38,"div",19),t.TgZ(39,"div",20),t.TgZ(40,"div",21),t.TgZ(41,"div",22),t.TgZ(42,"span",23),t._uU(43,"Subtotal"),t.qZA(),t.TgZ(44,"span"),t._uU(45),t.ALo(46,"number"),t.qZA(),t.qZA(),t.TgZ(47,"div",22),t.TgZ(48,"span",23),t._uU(49,"Impuesto"),t.qZA(),t.TgZ(50,"span"),t._uU(51),t.ALo(52,"number"),t.qZA(),t.qZA(),t.TgZ(53,"div",22),t.TgZ(54,"span",23),t._uU(55,"Total"),t.qZA(),t.TgZ(56,"span"),t._uU(57),t.ALo(58,"number"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&i){const e=t.oxw();t.xp6(4),t.hij(" Orden de venta No. ",null==e.order?null:e.order.id," "),t.xp6(2),t.Q6J("disabled",e.loading.creating),t.xp6(1),t.Q6J("ngIf",!e.loading.creating),t.xp6(1),t.Q6J("ngIf",e.loading.creating),t.xp6(3),t.hij(" ",null==e.order||null==e.order.client?null:e.order.client.name," "),t.xp6(2),t.hij(" ",e.GenerateClientAddress(null==e.order?null:e.order.clientAddress)," "),t.xp6(2),t.Q6J("items",e.orderStatuses)("ngModel",e.order.statusId),t.xp6(2),t.hij(" ",null==e.orderDate?null:e.orderDate.format("YYYY/MM/DD")," "),t.xp6(20),t.Q6J("ngForOf",null==e.order?null:e.order.items),t.xp6(8),t.hij("$",t.xi3(46,13,e.orderSubtotal,"0.2-2"),""),t.xp6(6),t.hij("$",t.xi3(52,16,e.orderTaxes,"0.2-2"),""),t.xp6(6),t.hij("$",t.xi3(58,19,e.orderTotal,"0.2-2"),"")}}function A(i,d){1&i&&(t.TgZ(0,"div",33),t._UZ(1,"i",34),t.qZA())}const O=[{path:"",component:(()=>{class i{constructor(e,r,n,o){this.http=e,this.toast=r,this.nav=n,this.activatedRoute=o,this.IVA=.16,this.clients=[],this.selectedClient=null,this.measurementTypes=[],this.orderId=null,this.order=null,this.orderStatuses=[],this.orderDate=null,this.orderItem={product:null,quantity:null,weight:null,tax:0,price:0,total:0},this.loading={getting:!1,creating:!1}}get orderSubtotal(){let e=0;return this.order.items.forEach(r=>{r.price&&(e+=r.price)}),e}get orderTaxes(){let e=0;return this.order.items.forEach(r=>{r.tax&&(e+=r.tax)}),e}get orderTotal(){let e=0;return this.order.items.forEach(r=>{r.total&&(e+=r.total)}),e}ngOnInit(){this.GetClients(),this.GetParams()}GetParams(){this.activatedRoute.params.subscribe(e=>{this.orderId=e.orderId,this.GetOrder()})}GoBack(){this.nav.GoToRoleRoute("sell-orders")}GetClients(){this.http.Get("/Clients").subscribe(r=>{this.clients=r},r=>{console.error("Error getting clients",r)})}GetOrderStatuses(){this.http.Get("OrderStatuses").subscribe(e=>{this.orderStatuses=this.FilterOrderStatuses(e),this.loading.getting=!1},e=>{console.error("Error getting order statuses",e),this.loading.getting=!1})}FilterOrderStatuses(e){return e.filter(r=>{let n=["Pagado","Incobrable"];return"Pedido creado"!=this.order.status.name&&n.push("Pedido creado"),!n.includes(r.name)})}GetOrder(){this.loading.getting=!0,this.http.Get(`Orders/${this.orderId}`).subscribe(e=>{this.order=e,this.selectedClient=e.client,this.orderDate=m(e.date),this.GetOrderStatuses()},e=>{console.error("Error getting order",e),this.loading.getting=!1})}OnWeightOrQuantityChange(e){if(e.product){const r=e.product.prices.length?e.product.prices[0].salePrice:e.product.price;let n=0;if(n="pz"===e.product.salesMeasurementType.abrev?e.quantity?e.quantity:0:e.weight?e.weight:0,!Number.isNaN(Number(n))){const o=r*Number(this.selectedClient.utilityPercentage)/100;e.price=Number(n)*(r+o),e.tax=e.price*this.IVA,e.total=e.price+e.tax}}}SaveOrder(){let e=this.ValidateOrderData();if(e)return void this.toast.ShowDefaultWarning(e,"La orden no es valida");let r={id:this.orderId,items:this.order.items,subtotal:this.orderSubtotal,taxes:this.orderTaxes,total:this.orderTotal,statusId:this.GetOrderStatusId()};this.http.Patch("Orders",{order:r}).subscribe(n=>{this.toast.ShowDefaultSuccess("Orden creada exitosamente"),this.nav.GoToRoleRoute("sell-orders")},n=>{console.error("Error creating order",n)})}GetOrderStatusId(){let e=this.order.statusId;if(this.order.client.paymentDays){const r=this.orderStatuses.find(n=>n.id==e);if("Pedido entregado"==(null==r?void 0:r.name)){const n=this.orderStatuses.find(o=>"Pendiente de pago"==o.name);e=null==n?void 0:n.id}}return e}ValidateOrderData(){let e=null;return this.order.statusId?(this.order.items.forEach((r,n)=>{if(!r.product)return e=`La fila ${n+1} no tiene producto seleccionado`;if("pz"===r.product.salesMeasurementType.abrev){if(!r.quantity||Number.isNaN(r.quantity))return e=`El producto ${r.product.name} no tiene cantidad de Pz valida`}else if(!r.weight||Number.isNaN(r.weight))return e=`El producto ${r.product.name} no tiene cantidad de Kg valida`}),e):e="La orden no tiene un estatus"}GenerateClientAddress(e){return e?e.street+" #"+e.externalNumber+(e.internalNumber?" int. "+e.internalNumber:""):""}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(f.O),t.Y36(x.k),t.Y36(Z.f),t.Y36(g.gz))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-sell-order"]],decls:3,vars:2,consts:[["class","content d-flex flex-column",4,"ngIf","ngIfElse"],["bigLoading",""],[1,"content","d-flex","flex-column"],[1,"d-flex","align-items-center","justify-content-between"],[1,"page-title"],[1,"zmdi","zmdi-arrow-back","zmdi-hc-lg","mr-2","clickeable",3,"click"],[1,"d-flex"],[1,"btn","btn-success","mx-1",3,"disabled","click"],[4,"ngIf"],[1,"h-row","mb-3"],[1,"fake-form-control","h-item"],[1,"form-group","my-3","h-item"],["bindValue","id","bindLabel","name","placeholder","Estatus",1,"clients-select",3,"items","ngModel","ngModelChange"],[1,"flex-grow-1","overflow-auto"],[1,"table"],[1,"position-sticky",2,"top","0","z-index","1"],[1,"small-width"],[1,"medium-width"],[4,"ngFor","ngForOf"],[1,"order-summary"],[1,"card"],[1,"d-flex","flex-column"],[1,"summary-row"],[2,"font-weight","600"],[1,"zmdi","zmdi-save","zmdi-hc-lg","mr-2"],[1,"zmdi","zmdi-spinner","zmdi-hc-spin","zmdi-hc-lg"],[1,"align-middle","small-width",2,"max-width","50px !important"],[1,"d-flex","align-items-center","justify-content-center"],[1,"align-middle",2,"width","150px","max-width","100%"],[1,"align-middle","medium-width"],[1,"input-container"],["placeholder","Piezas","type","text",1,"form-control","no-icon",3,"ngModel","input","ngModelChange"],["placeholder","Kilogramos","type","text",1,"form-control","no-icon",3,"ngModel","input","ngModelChange"],[1,"d-flex","align-items-center","justify-content-center","h-100"],[1,"zmdi","zmdi-spinner","zmdi-hc-5x","zmdi-hc-spin"]],template:function(e,r){if(1&e&&(t.YNc(0,C,59,22,"div",0),t.YNc(1,A,2,0,"ng-template",null,1,t.W1O)),2&e){const n=t.MAs(2);t.Q6J("ngIf",!!r.order)("ngIfElse",n)}},directives:[c.O5,h.w9,s.JJ,s.On,c.sg,s.Fj],pipes:[c.JJ],styles:[".clients-select[_ngcontent-%COMP%]{width:100%}.small-width[_ngcontent-%COMP%]{max-width:70px}.medium-width[_ngcontent-%COMP%]{min-width:120px}table[_ngcontent-%COMP%]{overflow-y:visible!important}.order-summary[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;margin:1rem 0}.summary-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;color:#000;font-size:1.25rem}.order-summary[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{width:400px;max-width:100%}.h-row[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap;grid-gap:24px;gap:24px}.h-item[_ngcontent-%COMP%]{flex-basis:20%;flex-grow:1;width:260px;min-height:46px;height:-moz-fit-content;height:fit-content}"]}),i})()}];let b=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[s.u5,c.ez,h.A0,p.I,s.UX,g.Bz.forChild(O)]]}),i})()}}]);