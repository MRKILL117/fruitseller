"use strict";(self.webpackChunkfront=self.webpackChunkfront||[]).push([[218],{1218:(v,m,o)=>{o.r(m),o.d(m,{SellOrderModule:()=>q});var s=o(6019),h=o(850),u=o(7537),_=o(1435),f=o(7591),c=o(4684),t=o(1514),d=o(7754),g=o(6588),x=o(6155);function Z(i,l){1&i&&(t.ynx(0),t._UZ(1,"i",22),t._uU(2," Guardar "),t.BQk())}function T(i,l){1&i&&(t.ynx(0),t._UZ(1,"i",23),t.BQk())}function O(i,l){if(1&i&&(t.TgZ(0,"div",30),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.quantity," ")}}function A(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"div",31),t.TgZ(1,"input",32),t.NdJ("input",function(){t.CHM(e);const r=t.oxw().$implicit;return t.oxw(2).OnWeightOrQuantityChange(r)})("ngModelChange",function(r){return t.CHM(e),t.oxw().$implicit.quantity=r}),t.qZA(),t.qZA()}if(2&i){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngModel",e.quantity)}}function C(i,l){if(1&i&&(t.TgZ(0,"div",30),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.weight," ")}}function y(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"div",31),t.TgZ(1,"input",33),t.NdJ("input",function(){t.CHM(e);const r=t.oxw().$implicit;return t.oxw(2).OnWeightOrQuantityChange(r)})("ngModelChange",function(r){return t.CHM(e),t.oxw().$implicit.weight=r}),t.qZA(),t.qZA()}if(2&i){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngModel",e.weight)}}function w(i,l){if(1&i&&(t.TgZ(0,"tr"),t.TgZ(1,"td",24),t.TgZ(2,"div",25),t._uU(3),t.qZA(),t.qZA(),t.TgZ(4,"td",26),t._uU(5),t.qZA(),t.TgZ(6,"td",27),t.YNc(7,O,2,1,"div",28),t.YNc(8,A,2,1,"div",29),t.qZA(),t.TgZ(9,"td",27),t.YNc(10,C,2,1,"div",28),t.YNc(11,y,2,1,"div",29),t.qZA(),t.TgZ(12,"td",27),t._uU(13),t.ALo(14,"number"),t.qZA(),t.TgZ(15,"td",27),t._uU(16),t.ALo(17,"number"),t.qZA(),t.TgZ(18,"td",27),t._uU(19),t.ALo(20,"number"),t.qZA(),t.qZA()),2&i){const e=l.$implicit,n=l.index,r=t.oxw(2);t.xp6(3),t.hij(" ",n+1," "),t.xp6(2),t.hij(" ",null==e.product?null:e.product.name," "),t.xp6(2),t.Q6J("ngIf",r.paymentMode),t.xp6(1),t.Q6J("ngIf",!r.paymentMode),t.xp6(2),t.Q6J("ngIf",r.paymentMode),t.xp6(1),t.Q6J("ngIf",!r.paymentMode),t.xp6(2),t.hij(" $",t.xi3(14,9,e.tax,"0.2-2")," "),t.xp6(3),t.hij(" $",t.xi3(17,12,e.price,"0.2-2")," "),t.xp6(3),t.hij(" $",t.xi3(20,15,e.total,"0.2-2")," ")}}function M(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"div",2),t.TgZ(1,"div",3),t.TgZ(2,"div",4),t.TgZ(3,"i",5),t.NdJ("click",function(){return t.CHM(e),t.oxw().GoBack()}),t.qZA(),t._uU(4),t.qZA(),t.TgZ(5,"div",6),t.TgZ(6,"button",7),t.NdJ("click",function(){return t.CHM(e),t.oxw().SaveOrder()}),t.YNc(7,Z,3,0,"ng-container",8),t.YNc(8,T,2,0,"ng-container",8),t.qZA(),t.qZA(),t.qZA(),t.TgZ(9,"div",9),t.TgZ(10,"div",10),t._uU(11),t.qZA(),t.TgZ(12,"div",10),t._uU(13),t.qZA(),t.TgZ(14,"div",10),t._uU(15),t.qZA(),t.TgZ(16,"div",10),t._uU(17),t.qZA(),t.qZA(),t.TgZ(18,"div",11),t.TgZ(19,"table",12),t.TgZ(20,"thead",13),t.TgZ(21,"tr"),t.TgZ(22,"th",14),t._uU(23,"#"),t.qZA(),t.TgZ(24,"th",15),t._uU(25,"Producto"),t.qZA(),t.TgZ(26,"th",15),t._uU(27,"Cantidad Pz"),t.qZA(),t.TgZ(28,"th",15),t._uU(29,"Cantidad Kg"),t.qZA(),t.TgZ(30,"th",15),t._uU(31,"Impuesto"),t.qZA(),t.TgZ(32,"th",15),t._uU(33,"Precio"),t.qZA(),t.TgZ(34,"th",15),t._uU(35,"Total"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(36,"tbody"),t.YNc(37,w,21,18,"tr",16),t.qZA(),t.qZA(),t.qZA(),t.TgZ(38,"div",17),t.TgZ(39,"div",18),t.TgZ(40,"div",19),t.TgZ(41,"div",20),t.TgZ(42,"span",21),t._uU(43,"Subtotal"),t.qZA(),t.TgZ(44,"span"),t._uU(45),t.ALo(46,"number"),t.qZA(),t.qZA(),t.TgZ(47,"div",20),t.TgZ(48,"span",21),t._uU(49,"Impuesto"),t.qZA(),t.TgZ(50,"span"),t._uU(51),t.ALo(52,"number"),t.qZA(),t.qZA(),t.TgZ(53,"div",20),t.TgZ(54,"span",21),t._uU(55,"Total"),t.qZA(),t.TgZ(56,"span"),t._uU(57),t.ALo(58,"number"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&i){const e=t.oxw();t.xp6(4),t.hij(" Orden de venta No. ",null==e.order?null:e.order.id," "),t.xp6(2),t.Q6J("disabled",e.loading.creating),t.xp6(1),t.Q6J("ngIf",!e.loading.creating),t.xp6(1),t.Q6J("ngIf",e.loading.creating),t.xp6(3),t.hij(" ",null==e.order||null==e.order.client?null:e.order.client.name," "),t.xp6(2),t.hij(" ",e.GenerateClientAddress(null==e.order?null:e.order.clientAddress)," "),t.xp6(2),t.hij(" ",null==e.order.status?null:e.order.status.name," "),t.xp6(2),t.hij(" ",null==e.orderDate?null:e.orderDate.format("YYYY/MM/DD")," "),t.xp6(20),t.Q6J("ngForOf",null==e.order?null:e.order.items),t.xp6(8),t.hij("$",t.xi3(46,12,e.orderSubtotal,"0.2-2"),""),t.xp6(6),t.hij("$",t.xi3(52,15,e.orderTaxes,"0.2-2"),""),t.xp6(6),t.hij("$",t.xi3(58,18,e.orderTotal,"0.2-2"),"")}}function S(i,l){1&i&&(t.TgZ(0,"div",34),t._UZ(1,"i",35),t.qZA())}const b=[{path:"",component:(()=>{class i{constructor(e,n,r,a){this.http=e,this.toast=n,this.nav=r,this.activatedRoute=a,this.IVA=.16,this.clients=[],this.selectedClient=null,this.measurementTypes=[],this.paymentMode=!1,this.orderId=null,this.order=null,this.orderStatuses=[],this.orderDate=null,this.orderItem={product:null,quantity:null,weight:null,tax:0,price:0,total:0},this.loading={getting:!1,creating:!1}}get orderSubtotal(){let e=0;return this.order.items.forEach(n=>{n.price&&(e+=n.price)}),e}get orderTaxes(){let e=0;return this.order.items.forEach(n=>{n.tax&&(e+=n.tax)}),e}get orderTotal(){let e=0;return this.order.items.forEach(n=>{n.total&&(e+=n.total)}),e}ngOnInit(){let e=localStorage.getItem("paymentMode");null!==e&&(this.paymentMode=JSON.parse(e)),this.GetClients(),this.GetParams()}GetParams(){this.activatedRoute.params.subscribe(e=>{this.orderId=e.orderId,this.GetOrder()})}GoBack(){this.paymentMode?(localStorage.removeItem("paymentMode"),this.nav.GoToRoleRoute("payments")):this.nav.GoToRoleRoute("sell-orders")}GetClients(){this.http.Get("/Clients").subscribe(n=>{this.clients=n},n=>{console.error("Error getting clients",n)})}GetOrderStatuses(){this.http.Get("OrderStatuses").subscribe(e=>{this.orderStatuses=this.FilterOrderStatuses(e),this.loading.getting=!1},e=>{console.error("Error getting order statuses",e),this.loading.getting=!1})}FilterOrderStatuses(e){return e.filter(n=>{let r=[];return"Pedido creado"!=this.order.status.name&&(r=["Pagado","Incobrable"],r.push("Pedido creado")),this.paymentMode&&(r=["Pedido creado","Pedido entregado"]),!r.includes(n.name)})}GetOrder(){this.loading.getting=!0,this.http.Get(`Orders/${this.orderId}`).subscribe(e=>{this.order=e,this.selectedClient=e.client,this.orderDate=c(e.date),this.GetOrderStatuses()},e=>{console.error("Error getting order",e),this.loading.getting=!1})}OnWeightOrQuantityChange(e){var n,r;if(e.product){const a=(null===(r=null===(n=e.product)||void 0===n?void 0:n.prices)||void 0===r?void 0:r.length)?e.product.prices[0].salePrice:e.product.price;let p=0;if(p="pz"===e.product.salesMeasurementType.abrev?e.quantity?e.quantity:0:e.weight?e.weight:0,!Number.isNaN(Number(p))){const I=a*Number(this.selectedClient.utilityPercentage)/100;e.price=Number(p)*(a+I),e.tax=e.price*this.IVA,e.total=e.price+e.tax}}}SaveOrder(){let e=this.ValidateOrderData();if(e)return void this.toast.ShowDefaultWarning(e,"La orden no es valida");let n={id:this.orderId,items:this.order.items,subtotal:this.orderSubtotal,taxes:this.orderTaxes,total:this.orderTotal,statusId:this.GetOrderStatusId()};this.http.Patch(`Orders/${n.id}`,{order:n}).subscribe(r=>{this.toast.ShowDefaultSuccess("Orden creada exitosamente"),this.nav.GoToRoleRoute("sell-orders")},r=>{console.error("Error creating order",r)})}GetOrderStatusId(){let e=this.order.statusId;if(this.order.client.paymentDays){const n=this.orderStatuses.find(r=>r.id==e);if("Pedido entregado"==(null==n?void 0:n.name)){const r=this.orderStatuses.find(a=>"Pendiente de pago"==a.name);e=null==r?void 0:r.id}}return e}ValidateOrderData(){let e=null;return this.order.statusId?(this.order.items.forEach((n,r)=>{if(!n.product)return e=`La fila ${r+1} no tiene producto seleccionado`;if("pz"===n.product.salesMeasurementType.abrev){if(!n.quantity||Number.isNaN(n.quantity))return e=`El producto ${n.product.name} no tiene cantidad de Pz valida`}else if(!n.weight||Number.isNaN(n.weight))return e=`El producto ${n.product.name} no tiene cantidad de Kg valida`}),e):e="La orden no tiene un estatus"}GenerateClientAddress(e){return e?e.street+" #"+e.externalNumber+(e.internalNumber?" int. "+e.internalNumber:""):""}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(d.O),t.Y36(g.k),t.Y36(x.f),t.Y36(h.gz))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-sell-order"]],decls:3,vars:2,consts:[["class","content d-flex flex-column",4,"ngIf","ngIfElse"],["bigLoading",""],[1,"content","d-flex","flex-column"],[1,"d-flex","align-items-center","justify-content-between"],[1,"page-title"],[1,"zmdi","zmdi-arrow-back","zmdi-hc-lg","mr-2","clickeable",3,"click"],[1,"d-flex"],[1,"btn","btn-success","mx-1",3,"disabled","click"],[4,"ngIf"],[1,"h-row","mb-3"],[1,"fake-form-control","h-item"],[1,"flex-grow-1","overflow-auto"],[1,"table"],[1,"position-sticky",2,"top","0","z-index","1"],[1,"small-width"],[1,"medium-width"],[4,"ngFor","ngForOf"],[1,"order-summary"],[1,"card"],[1,"d-flex","flex-column"],[1,"summary-row"],[2,"font-weight","600"],[1,"zmdi","zmdi-save","zmdi-hc-lg","mr-2"],[1,"zmdi","zmdi-spinner","zmdi-hc-spin","zmdi-hc-lg"],[1,"align-middle","small-width",2,"max-width","50px !important"],[1,"d-flex","align-items-center","justify-content-center"],[1,"align-middle",2,"width","150px","max-width","100%"],[1,"align-middle","medium-width"],["class","fake-form-control",4,"ngIf"],["class","input-container",4,"ngIf"],[1,"fake-form-control"],[1,"input-container"],["placeholder","Piezas","type","text",1,"form-control","no-icon",3,"ngModel","input","ngModelChange"],["placeholder","Kilogramos","type","text",1,"form-control","no-icon",3,"ngModel","input","ngModelChange"],[1,"d-flex","align-items-center","justify-content-center","h-100"],[1,"zmdi","zmdi-spinner","zmdi-hc-5x","zmdi-hc-spin"]],template:function(e,n){if(1&e&&(t.YNc(0,M,59,21,"div",0),t.YNc(1,S,2,0,"ng-template",null,1,t.W1O)),2&e){const r=t.MAs(2);t.Q6J("ngIf",!!n.order)("ngIfElse",r)}},directives:[s.O5,s.sg,u.Fj,u.JJ,u.On],pipes:[s.JJ],styles:[".clients-select[_ngcontent-%COMP%]{width:100%}.small-width[_ngcontent-%COMP%]{max-width:70px}.medium-width[_ngcontent-%COMP%]{min-width:120px}table[_ngcontent-%COMP%]{overflow-y:visible!important}.order-summary[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;margin:1rem 0}.summary-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;color:#000;font-size:1.25rem}.order-summary[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{width:400px;max-width:100%}.h-row[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap;grid-gap:24px;gap:24px}.h-item[_ngcontent-%COMP%]{flex-basis:20%;flex-grow:1;width:260px;min-height:46px;height:-moz-fit-content;height:fit-content}"]}),i})()}];let q=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[u.u5,s.ez,_.A0,f.I,u.UX,h.Bz.forChild(b)]]}),i})()},6155:(v,m,o)=>{o.d(m,{f:()=>f});var s=o(1514),h=o(850),u=o(9299),_=o(6588);let f=(()=>{class c{constructor(d,g,x){this.router=d,this.role=g,this.toast=x}FormatRoute(d){return"/"==d.charAt(0)?`${d.split("").slice(1).join("")}`:d}GoToRoleRoute(d){const g=this.role.GetUserRole();g?this.router.navigate([`/${g.toLowerCase()}/${this.FormatRoute(d)}`]):this.toast.ShowDefaultDanger("Rol de usuario no valido","Ruta invalida")}}return c.\u0275fac=function(d){return new(d||c)(s.LFG(h.F0),s.LFG(u.N),s.LFG(_.k))},c.\u0275prov=s.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})()}}]);