"use strict";(self.webpackChunkfront=self.webpackChunkfront||[]).push([[218],{1218:(w,u,o)=>{o.r(u),o.d(u,{SellOrderModule:()=>b});var c=o(6019),g=o(850),s=o(7537),p=o(1435),h=o(7591),m=o(4684),t=o(1514),Z=o(7754),x=o(6588),f=o(6155);function _(r,l){1&r&&(t.ynx(0),t._UZ(1,"i",24),t._uU(2," Guardar "),t.BQk())}function T(r,l){1&r&&(t.ynx(0),t._UZ(1,"i",25),t.BQk())}function C(r,l){if(1&r){const e=t.EpF();t.TgZ(0,"tr"),t.TgZ(1,"td",26),t.TgZ(2,"div",27),t._uU(3),t.qZA(),t.qZA(),t.TgZ(4,"td",28),t._uU(5),t.qZA(),t.TgZ(6,"td",29),t.TgZ(7,"div",30),t.TgZ(8,"input",31),t.NdJ("input",function(){const d=t.CHM(e).$implicit;return t.oxw(2).OnWeightOrQuantityChange(d)})("ngModelChange",function(i){return t.CHM(e).$implicit.quantity=i}),t.qZA(),t.qZA(),t.qZA(),t.TgZ(9,"td",29),t.TgZ(10,"div",30),t.TgZ(11,"input",32),t.NdJ("input",function(){const d=t.CHM(e).$implicit;return t.oxw(2).OnWeightOrQuantityChange(d)})("ngModelChange",function(i){return t.CHM(e).$implicit.weight=i}),t.qZA(),t.qZA(),t.qZA(),t.TgZ(12,"td",29),t._uU(13),t.ALo(14,"number"),t.qZA(),t.TgZ(15,"td",29),t._uU(16),t.ALo(17,"number"),t.qZA(),t.TgZ(18,"td",29),t._uU(19),t.ALo(20,"number"),t.qZA(),t.qZA()}if(2&r){const e=l.$implicit,n=l.index;t.xp6(3),t.hij(" ",n+1," "),t.xp6(2),t.hij(" ",e.product.name," "),t.xp6(3),t.Q6J("ngModel",e.quantity),t.xp6(3),t.Q6J("ngModel",e.weight),t.xp6(2),t.hij(" $",t.xi3(14,7,e.tax,"0.2-2")," "),t.xp6(3),t.hij(" $",t.xi3(17,10,e.price,"0.2-2")," "),t.xp6(3),t.hij(" $",t.xi3(20,13,e.total,"0.2-2")," ")}}function v(r,l){if(1&r){const e=t.EpF();t.TgZ(0,"div",2),t.TgZ(1,"div",3),t.TgZ(2,"div",4),t.TgZ(3,"i",5),t.NdJ("click",function(){return t.CHM(e),t.oxw().GoBack()}),t.qZA(),t._uU(4),t.qZA(),t.TgZ(5,"div",6),t.TgZ(6,"button",7),t.NdJ("click",function(){return t.CHM(e),t.oxw().SaveOrder()}),t.YNc(7,_,3,0,"ng-container",8),t.YNc(8,T,2,0,"ng-container",8),t.qZA(),t.qZA(),t.qZA(),t.TgZ(9,"div",9),t.TgZ(10,"div",10),t._uU(11),t.qZA(),t.TgZ(12,"div",11),t.TgZ(13,"ng-select",12),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().order.statusId=i}),t.qZA(),t.qZA(),t.TgZ(14,"div",10),t._uU(15),t.qZA(),t.qZA(),t.TgZ(16,"div",13),t.TgZ(17,"table",14),t.TgZ(18,"thead",15),t.TgZ(19,"tr"),t.TgZ(20,"th",16),t._uU(21,"#"),t.qZA(),t.TgZ(22,"th",17),t._uU(23,"Producto"),t.qZA(),t.TgZ(24,"th",17),t._uU(25,"Cantidad Pz"),t.qZA(),t.TgZ(26,"th",17),t._uU(27,"Cantidad Kg"),t.qZA(),t.TgZ(28,"th",17),t._uU(29,"Impuesto"),t.qZA(),t.TgZ(30,"th",17),t._uU(31,"Precio"),t.qZA(),t.TgZ(32,"th",17),t._uU(33,"Total"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(34,"tbody"),t.YNc(35,C,21,16,"tr",18),t.qZA(),t.qZA(),t.qZA(),t.TgZ(36,"div",19),t.TgZ(37,"div",20),t.TgZ(38,"div",21),t.TgZ(39,"div",22),t.TgZ(40,"span",23),t._uU(41,"Subtotal"),t.qZA(),t.TgZ(42,"span"),t._uU(43),t.ALo(44,"number"),t.qZA(),t.qZA(),t.TgZ(45,"div",22),t.TgZ(46,"span",23),t._uU(47,"Impuesto"),t.qZA(),t.TgZ(48,"span"),t._uU(49),t.ALo(50,"number"),t.qZA(),t.qZA(),t.TgZ(51,"div",22),t.TgZ(52,"span",23),t._uU(53,"Total"),t.qZA(),t.TgZ(54,"span"),t._uU(55),t.ALo(56,"number"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&r){const e=t.oxw();t.xp6(4),t.hij(" Orden de venta No. ",null==e.order?null:e.order.id," "),t.xp6(2),t.Q6J("disabled",e.loading.creating),t.xp6(1),t.Q6J("ngIf",!e.loading.creating),t.xp6(1),t.Q6J("ngIf",e.loading.creating),t.xp6(3),t.hij(" ",null==e.selectedClient?null:e.selectedClient.name," "),t.xp6(2),t.Q6J("items",e.orderStatuses)("ngModel",e.order.statusId),t.xp6(2),t.hij(" ",null==e.orderDate?null:e.orderDate.format("YYYY/MM/DD")," "),t.xp6(20),t.Q6J("ngForOf",null==e.order?null:e.order.items),t.xp6(8),t.hij("$",t.xi3(44,12,e.orderSubtotal,"0.2-2"),""),t.xp6(6),t.hij("$",t.xi3(50,15,e.orderTaxes,"0.2-2"),""),t.xp6(6),t.hij("$",t.xi3(56,18,e.orderTotal,"0.2-2"),"")}}function A(r,l){1&r&&(t.TgZ(0,"div",33),t._UZ(1,"i",34),t.qZA())}const O=[{path:"",component:(()=>{class r{constructor(e,n,i,d){this.http=e,this.toast=n,this.nav=i,this.activatedRoute=d,this.IVA=.16,this.clients=[],this.selectedClient=null,this.measurementTypes=[],this.orderId=null,this.order=null,this.orderStatuses=[],this.orderDate=null,this.orderItem={product:null,quantity:null,weight:null,tax:0,price:0,total:0},this.loading={getting:!1,creating:!1}}get orderSubtotal(){let e=0;return this.order.items.forEach(n=>{n.price&&(e+=n.price)}),e}get orderTaxes(){let e=0;return this.order.items.forEach(n=>{n.tax&&(e+=n.tax)}),e}get orderTotal(){let e=0;return this.order.items.forEach(n=>{n.total&&(e+=n.total)}),e}ngOnInit(){this.GetClients(),this.GetOrderStatuses(),this.GetParams()}GetParams(){this.activatedRoute.params.subscribe(e=>{this.orderId=e.orderId,this.GetOrder()})}GoBack(){this.nav.GoToRoleRoute("sell-orders")}GetClients(){this.http.Get("/Clients").subscribe(n=>{this.clients=n},n=>{console.error("Error getting clients",n)})}GetOrderStatuses(){this.http.Get("OrderStatuses").subscribe(e=>{this.orderStatuses=e},e=>{console.error("Error getting order statuses",e)})}GetOrder(){this.loading.getting=!0,this.http.Get(`Orders/${this.orderId}`).subscribe(e=>{this.order=e,this.selectedClient=e.client,this.orderDate=m(e.date),this.loading.getting=!1},e=>{console.error("Error getting order",e),this.loading.getting=!1})}OnWeightOrQuantityChange(e){if(e.product){const n=e.product.prices.length?e.product.prices[0].salePrice:e.product.price;let i=0;if(i="pz"===e.product.salesMeasurementType.abrev?e.quantity?e.quantity:0:e.weight?e.weight:0,!Number.isNaN(Number(i))){const d=n*Number(this.selectedClient.utilityPercentage)/100;e.price=Number(i)*(n+d),e.tax=e.price*this.IVA,e.total=e.price+e.tax}}}SaveOrder(){let e=this.ValidateOrderData();e?this.toast.ShowDefaultWarning(e,"La orden no es valida"):this.http.Patch("Orders",{order:{id:this.orderId,items:this.order.items,subtotal:this.orderSubtotal,taxes:this.orderTaxes,total:this.orderTotal,statusId:this.order.statusId}}).subscribe(i=>{this.toast.ShowDefaultSuccess("Orden creada exitosamente"),this.nav.GoToRoleRoute("sell-orders")},i=>{console.error("Error creating order",i)})}ValidateOrderData(){let e=null;return this.order.statusId?(this.order.items.forEach((n,i)=>{if(!n.product)return e=`La fila ${i+1} no tiene producto seleccionado`;if("pz"===n.product.salesMeasurementType.abrev){if(!n.quantity||Number.isNaN(n.quantity))return e=`El producto ${n.product.name} no tiene cantidad de Pz valida`}else if(!n.weight||Number.isNaN(n.weight))return e=`El producto ${n.product.name} no tiene cantidad de Kg valida`}),e):e="La orden no tiene un estatus"}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(Z.O),t.Y36(x.k),t.Y36(f.f),t.Y36(g.gz))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-sell-order"]],decls:3,vars:2,consts:[["class","content d-flex flex-column",4,"ngIf","ngIfElse"],["bigLoading",""],[1,"content","d-flex","flex-column"],[1,"d-flex","align-items-center","justify-content-between"],[1,"page-title"],[1,"zmdi","zmdi-arrow-back","zmdi-hc-lg","mr-2","clickeable",3,"click"],[1,"d-flex"],[1,"btn","btn-success","mx-1",3,"disabled","click"],[4,"ngIf"],[1,"d-flex","align-items-center","justify-content-between","flex-wrap"],[1,"fake-form-control"],[1,"flex-50-item","form-group","my-3"],["bindValue","id","bindLabel","name","placeholder","Estatus",1,"clients-select",3,"items","ngModel","ngModelChange"],[1,"flex-grow-1","overflow-auto"],[1,"table"],[1,"position-sticky",2,"top","0","z-index","1"],[1,"small-width"],[1,"medium-width"],[4,"ngFor","ngForOf"],[1,"order-summary"],[1,"card"],[1,"d-flex","flex-column"],[1,"summary-row"],[2,"font-weight","600"],[1,"zmdi","zmdi-save","zmdi-hc-lg","mr-2"],[1,"zmdi","zmdi-spinner","zmdi-hc-spin","zmdi-hc-lg"],[1,"align-middle","small-width",2,"max-width","50px !important"],[1,"d-flex","align-items-center","justify-content-center"],[1,"align-middle",2,"width","150px","max-width","100%"],[1,"align-middle","medium-width"],[1,"input-container"],["placeholder","Piezas","type","text",1,"form-control","no-icon",3,"ngModel","input","ngModelChange"],["placeholder","Kilogramos","type","text",1,"form-control","no-icon",3,"ngModel","input","ngModelChange"],[1,"d-flex","align-items-center","justify-content-center","h-100"],[1,"zmdi","zmdi-spinner","zmdi-hc-5x","zmdi-hc-spin"]],template:function(e,n){if(1&e&&(t.YNc(0,v,57,21,"div",0),t.YNc(1,A,2,0,"ng-template",null,1,t.W1O)),2&e){const i=t.MAs(2);t.Q6J("ngIf",!!n.order)("ngIfElse",i)}},directives:[c.O5,p.w9,s.JJ,s.On,c.sg,s.Fj],pipes:[c.JJ],styles:[".clients-select[_ngcontent-%COMP%]{width:100%}.flex-50-item[_ngcontent-%COMP%]{width:40%!important;min-width:250px;max-width:100%}.small-width[_ngcontent-%COMP%]{max-width:70px}.medium-width[_ngcontent-%COMP%]{min-width:120px}table[_ngcontent-%COMP%]{overflow-y:visible!important}.order-summary[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;margin:1rem 0}.summary-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;color:#000;font-size:1.25rem}.order-summary[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{width:400px;max-width:100%}"]}),r})()}];let b=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[[s.u5,c.ez,p.A0,h.I,s.UX,g.Bz.forChild(O)]]}),r})()}}]);