"use strict";(self.webpackChunkfront=self.webpackChunkfront||[]).push([[122],{3122:(K,h,u)=>{u.r(h),u.d(h,{DailyShoppingListModule:()=>H});var p=u(6019),Z=u(850),y=u(7537),v=u(1435),b=u(3550),f=u(4684),x=u(8260),t=u(1514),q=u(822),A=u(9853),O=u(6588),_=u(7754),C=u(1843),w=u(6155),I=u(5749);function M(n,a){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" ",e.product.totalToBuy-e.product.inventory+" "+e.product.measurementType," ")}}function P(n,a){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" ","0 "+e.product.measurementType," ")}}function U(n,a){if(1&n&&(t.TgZ(0,"div",11),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit,o=t.oxw();t.xp6(1),t.Oqu(e.quantity+" "+o.product.measurementType)}}function N(n,a){if(1&n&&(t.TgZ(0,"div",11),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit,o=t.oxw();t.xp6(1),t.Oqu(e.oldQuantity+" "+e.measurementType+" ("+e.quantity+" "+o.product.measurementType+" aprox.)")}}function S(n,a){if(1&n&&(t.TgZ(0,"div",13),t.TgZ(1,"div",11),t._uU(2),t.qZA(),t.TgZ(3,"div",11),t._uU(4),t.qZA(),t.YNc(5,U,2,1,"div",14),t.YNc(6,N,2,1,"div",14),t.qZA()),2&n){const e=a.$implicit,o=t.oxw();t.xp6(2),t.Oqu(e.id),t.xp6(2),t.Oqu(e.currentInventory+" "+o.product.measurementType),t.xp6(1),t.Q6J("ngIf",e.isAccurate),t.xp6(1),t.Q6J("ngIf",!e.isAccurate)}}const z=function(n){return{"mb-3":n}},D=function(n){return{"caret-active":n}},F=function(n){return{"toggle-active":n}};let T=(()=>{class n{constructor(){this.product=null,this.toggleHistory=null,this.showHistory=!1}ngOnInit(){this.toggleHistory&&this.toggleHistory.subscribe(e=>{})}GetOrderProductShoppingQuantity(e){if(!e||!this.product)return 0;let o;return o=Number("pz"===this.product.measurementType?e.quantity?e.quantity:0:e.weight?e.weight:0),o}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-product-orders"]],inputs:{product:"product",toggleHistory:"toggleHistory"},decls:45,vars:17,consts:[[1,"card","d-flex","flex-column"],[3,"ngClass"],[1,"d-flex","align-items-center","justify-content-around","flex-wrap"],[1,"name","mx-2"],[1,"mx-2"],[1,"text-center"],[4,"ngIf"],[1,"clickeable",3,"click"],[1,"zmdi","zmdi-caret-down","zmdi-hc-3x",3,"ngClass"],[1,"d-flex","flex-column","price-history","position-relative",3,"ngClass"],[1,"div-table","t-header"],[1,"th"],["class","div-table t-body",4,"ngFor","ngForOf"],[1,"div-table","t-body"],["class","th",4,"ngIf"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"div",2),t.TgZ(3,"div",3),t._uU(4),t.qZA(),t.TgZ(5,"div",4),t.TgZ(6,"label"),t._uU(7,"Unidad de medida"),t.qZA(),t.TgZ(8,"div",5),t._uU(9),t.qZA(),t.qZA(),t.TgZ(10,"div",4),t.TgZ(11,"label"),t._uU(12,"Comprador"),t.qZA(),t.TgZ(13,"div",5),t._uU(14),t.qZA(),t.qZA(),t.TgZ(15,"div",4),t.TgZ(16,"label"),t._uU(17,"Inventario"),t.qZA(),t.TgZ(18,"div",5),t._uU(19),t.qZA(),t.qZA(),t.TgZ(20,"div",4),t.TgZ(21,"label"),t._uU(22,"Total ordenes"),t.qZA(),t.TgZ(23,"div",5),t._uU(24),t.qZA(),t.qZA(),t.TgZ(25,"div",4),t.TgZ(26,"label"),t._uU(27,"Total a comprar"),t.qZA(),t.TgZ(28,"div",5),t.YNc(29,M,2,1,"span",6),t.YNc(30,P,2,1,"span",6),t.qZA(),t.qZA(),t.TgZ(31,"div",7),t.NdJ("click",function(){return o.showHistory=!o.showHistory}),t._UZ(32,"i",8),t.qZA(),t.qZA(),t.qZA(),t.TgZ(33,"div",9),t.TgZ(34,"div",10),t.TgZ(35,"div",11),t.TgZ(36,"b"),t._uU(37,"Orden No."),t.qZA(),t.qZA(),t.TgZ(38,"div",11),t.TgZ(39,"b"),t._uU(40,"Inventario"),t.qZA(),t.qZA(),t.TgZ(41,"div",11),t.TgZ(42,"b"),t._uU(43,"Cantidad"),t.qZA(),t.qZA(),t.qZA(),t.YNc(44,S,7,4,"div",12),t.qZA(),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngClass",t.VKq(11,z,o.showHistory)),t.xp6(3),t.Oqu(null==o.product?null:o.product.name),t.xp6(5),t.hij(" ",o.product.measurementType," "),t.xp6(5),t.hij(" ",null==o.product.buyer?null:o.product.buyer.name," "),t.xp6(5),t.hij(" ",o.product.inventory+" "+o.product.measurementType," "),t.xp6(5),t.hij(" ",o.product.totalOrders+" "+o.product.measurementType," "),t.xp6(5),t.Q6J("ngIf",o.product.inventory<o.product.totalToBuy),t.xp6(1),t.Q6J("ngIf",o.product.inventory>o.product.totalToBuy),t.xp6(2),t.Q6J("ngClass",t.VKq(13,D,o.showHistory)),t.xp6(1),t.Q6J("ngClass",t.VKq(15,F,o.showHistory)),t.xp6(11),t.Q6J("ngForOf",null==o.product?null:o.product.orders))},directives:[p.mk,p.O5,p.sg],styles:[".price-history[_ngcontent-%COMP%]{height:0px;overflow-y:hidden;transition:all .3s ease-in-out;position:relative}.toggle-active[_ngcontent-%COMP%]{height:250px;overflow-y:auto}.zmdi-caret-down[_ngcontent-%COMP%]{transition:all .3s ease-in-out}.caret-active[_ngcontent-%COMP%]{transform:rotate(180deg)}.name[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600}.div-table[_ngcontent-%COMP%]{display:flex;align-items:center}.t-header[_ngcontent-%COMP%]{border-radius:12px 12px 0 0!important;background-color:#51a351!important;color:#fff;position:sticky;top:0}.t-body[_ngcontent-%COMP%]{border-top:1px solid #dee2e6}div.price-history[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:nth-of-type(odd){background:#F2F2F2}.th[_ngcontent-%COMP%]{height:50px;width:33%;display:flex;align-items:center;justify-content:center}.sticky-top[_ngcontent-%COMP%]{position:sticky;top:0}"]}),n})();const Q=function(n){return{text:!1,startDate:!1,endDate:!1,options:n,optionsLabel:"Seleccione un comprador"}};function k(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"app-filters",19),t.NdJ("onSearch",function(d){return t.CHM(e),t.oxw().OnFiltersChanged(d)}),t.qZA()}if(2&n){const e=t.oxw();t.Q6J("timerTrigger",!0)("filters",t.VKq(2,Q,e.buyers))}}function Y(n,a){if(1&n&&(t.TgZ(0,"div",20),t._UZ(1,"app-product-orders",21),t.qZA()),2&n){const e=a.$implicit;t.xp6(1),t.Q6J("product",e)}}function B(n,a){1&n&&(t.TgZ(0,"div",22),t._UZ(1,"i",23),t.qZA())}function J(n,a){1&n&&(t.TgZ(0,"div",24),t._uU(1," No se encontraron ordenesactivas del dia de ayer "),t.qZA())}let L=(()=>{class n{constructor(e,o,d,s,r,m){this.form=e,this.modal=o,this.toast=d,this.http=s,this.csv=r,this.nav=m,this.today=f(),this.buyers=[],this.orders=[],this.clients=[],this.products=[],this.productsWithInventories=[],this.productsObj={},this.selectedOrder=null,this.isEditing=!1,this.ordersToUpload=[],this.ordersFailed=[],this.loading={updating:!1,getting:!0},this.dataConversions=[{oldKey:"Nombre",newKey:"name"},{oldKey:"Precio",newKey:"price"},{oldKey:"Impuesto",newKey:"tax"},{oldKey:"Unidad de medida ventas",newKey:"salesMeasurementType"},{oldKey:"Unidad de medida inventario",newKey:"inventoryMeasurementType"}]}get csvAcceptLabel(){return this.ordersFailed.length?"Reintentar":"Subir"}ngOnInit(){this.GetBuyers(),this.GetClients(),this.GetProductWithInventories()}GoHome(){this.nav.GoToRoleRoute("")}GetBuyers(){this.http.Get("Buyers").subscribe(e=>{this.buyers=e},e=>{console.error("Error getting buyers",e)})}OnFiltersChanged(e=null){this.SetProductsArray("*"==(null==e?void 0:e.options)?null:null==e?void 0:e.options)}GetClients(){this.http.Get("/Clients").subscribe(e=>{this.clients=e},e=>{console.error("Error getting clients",e)})}GetProductWithInventories(){this.http.Get("Products/WithInventory").subscribe(e=>{this.productsWithInventories=e,this.GetOrders()},e=>{console.error("Error getting products inventories",e)})}GetOrders(){this.loading.getting=!0;let e="/Orders";e+=`/FilteredBy/StartDate/${f().tz(x.N.timezone).subtract(1,"day").startOf("day").add(6,"hours").toISOString()}/EndDate/*`,this.http.Get(e).subscribe(d=>{this.orders=d,this.OnFiltersChanged(),this.loading.getting=!1},d=>{console.error("Error getting orders",d),this.loading.getting=!1})}SetProductsArray(e=null){let o=new Map,d=!0;this.orders.forEach(s=>{s.items.forEach(r=>{const m=this.productsWithInventories.find(l=>l.id==r.product.id);let i=0,c=m?m.inventories[0].quantity:0;switch(d=!0,r.product.inventoryMeasurementType.abrev){case"kg":r.quantity?(i=Number(r.quantity)*r.product.weightPerPiece,d=!1):i=Number(r.weight);break;case"pz":r.weight?(i=Number(r.weight)/r.product.weightPerPiece,d=!1):i=Number(r.quantity)}if(e){if(e.id==r.product.buyer.id)if(o.has(r.product.id)){let l=o.get(r.product.id),g=l.orders.slice(-1)[0];l.totalOrders+=i,l.totalToBuy+=i,l.orders.push({id:s.id,currentInventory:g.nextInventory,nextInventory:g.nextInventory>i?g.nextInventory-i:0,measurementType:r.quantity?"pz":"kg",oldQuantity:r.quantity?Number(r.quantity):r.weight?Number(r.weight):0,quantity:i,isAccurate:d})}else o.set(r.product.id,{name:r.product.name,measurementType:r.product.inventoryMeasurementType.abrev,buyer:r.product.buyer,inventory:c,totalOrders:i,totalToBuy:i,orders:[{id:s.id,currentInventory:c,nextInventory:c>i?c-i:0,measurementType:r.quantity?"pz":"kg",oldQuantity:r.quantity?Number(r.quantity):r.weight?Number(r.weight):0,quantity:i,isAccurate:d}]})}else if(o.has(r.product.id)){let l=o.get(r.product.id),g=l.orders.slice(-1)[0];l.totalOrders+=i,l.totalToBuy+=i,l.orders.push({id:s.id,currentInventory:g.nextInventory,nextInventory:g.nextInventory>i?g.nextInventory-i:0,measurementType:r.quantity?"pz":"kg",oldQuantity:r.quantity?Number(r.quantity):r.weight?Number(r.weight):0,quantity:i,isAccurate:d})}else o.set(r.product.id,{name:r.product.name,measurementType:r.product.inventoryMeasurementType.abrev,buyer:r.product.buyer,inventory:c,totalOrders:i,totalToBuy:i,orders:[{id:s.id,currentInventory:c,nextInventory:c>i?c-i:0,measurementType:r.quantity?"pz":"kg",oldQuantity:r.quantity?Number(r.quantity):r.weight?Number(r.weight):0,quantity:i,isAccurate:d}]})})}),this.products=Array.from(o.values())}ExportData(){let d=this.products.map(s=>({buyer:s.buyer.name,product:s.name,measurement:s.measurementType,inventory:`${s.inventory.toFixed(2)} ${s.measurementType}`,totalOrders:`${s.totalOrders.toFixed(2)} ${s.measurementType}`,totalToBuy:`${(s.inventory<s.totalToBuy?s.totalToBuy-s.inventory:0).toFixed(2)} ${s.measurementType}`}));this.csv.GenerateCSV("compras_del_dia",d,["buyer","product","measurement","inventory","totalOrders","totalToBuy"],["Comprador","Producto","Unidad de medida","Inventario incial","Total odenes","Total a comprar"])}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(q.o),t.Y36(A.Z),t.Y36(O.k),t.Y36(_.O),t.Y36(C.M),t.Y36(w.f))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-daily-shopping-list"]],decls:24,vars:3,consts:[[1,"content"],[1,"d-flex","align-items-center","justify-content-between"],[1,"page-title"],[1,"zmdi","zmdi-home","zmdi-hc-lg","mr-2","clickeable",3,"click"],[1,"d-flex"],["id","csvordersDropdown","data-toggle","dropdown","aria-haspopup","true","aria-expanded","false",1,"clickeable","px-2"],[1,"btn","btn-success","mx-1"],[1,"zmdi","zmdi-file","zmdi-hc-lg","mr-2"],["aria-labelledby","csvordersDropdown",1,"dropdown-menu","px-1","py-1"],[1,"menu-list"],[1,"d-flex","align-items-center","px-3","my-1","clickeable-hover",3,"click"],[1,"zmdi","zmdi-file-plus"],[1,"pl-2"],[1,"row","justify-content-center"],[1,"col-12"],[3,"timerTrigger","filters","onSearch",4,"ngIf"],["class","col-12 my-4",4,"ngFor","ngForOf"],["bigLoading",""],["noOrdersMessage",""],[3,"timerTrigger","filters","onSearch"],[1,"col-12","my-4"],[3,"product"],[1,"w-100","h-75","d-flex","align-items-center","justify-content-center",2,"min-height","min-content"],[1,"zmdi","zmdi-spinner","zmdi-hc-5x","zmdi-hc-spin"],[1,"no-items-message"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"div",2),t.TgZ(3,"i",3),t.NdJ("click",function(){return o.GoHome()}),t.qZA(),t._uU(4),t.qZA(),t.TgZ(5,"div",4),t.TgZ(6,"div",5),t.TgZ(7,"button",6),t._UZ(8,"i",7),t._uU(9," CSV "),t.qZA(),t.TgZ(10,"div",8),t.TgZ(11,"div",9),t.TgZ(12,"div",10),t.NdJ("click",function(){return o.ExportData()}),t._UZ(13,"i",11),t.TgZ(14,"span",12),t._uU(15,"Exportar lista de compras"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(16,"div",13),t.TgZ(17,"div",14),t.YNc(18,k,1,4,"app-filters",15),t.qZA(),t.YNc(19,Y,2,1,"div",16),t.qZA(),t.qZA(),t.YNc(20,B,2,0,"ng-template",null,17,t.W1O),t.YNc(22,J,2,0,"ng-template",null,18,t.W1O)),2&e&&(t.xp6(4),t.hij(" Compras del dia ",o.today.format("DD/MM/YYYY")," "),t.xp6(14),t.Q6J("ngIf",!!o.buyers.length),t.xp6(1),t.Q6J("ngForOf",o.products))},directives:[p.O5,p.sg,I.b,T],styles:[""]}),n})(),G=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[y.u5,p.ez,v.A0,y.UX]]}),n})();const j=[{path:"",component:L}];let H=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[y.u5,p.ez,b.F,v.A0,G,y.UX,Z.Bz.forChild(j)]]}),n})()}}]);