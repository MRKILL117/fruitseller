"use strict";(self.webpackChunkfront=self.webpackChunkfront||[]).push([[388],{388:(S,p,c)=>{c.r(p),c.d(p,{PriceListModule:()=>L});var a=c(6019),P=c(3697),s=c(7537),u=c(1435),t=c(1514),m=c(5838),v=c(822),g=c(6588),h=c(6845);function y(i,n){1&i&&(t.TgZ(0,"span",18),t._uU(1," Campo obligatorio "),t.qZA())}function Z(i,n){1&i&&(t.TgZ(0,"span",18),t._uU(1," Valor invalido "),t.qZA())}function _(i,n){if(1&i&&(t.TgZ(0,"div",16),t.YNc(1,y,2,0,"span",17),t.YNc(2,Z,2,0,"span",17),t.qZA()),2&i){const e=t.oxw();let o,r;t.xp6(1),t.Q6J("ngIf",null==(o=e.form.GetFormControlByName(e.productPriceForm,"purchasePrice"))?null:o.errors.required),t.xp6(1),t.Q6J("ngIf",null==(r=e.form.GetFormControlByName(e.productPriceForm,"purchasePrice"))?null:r.errors.pricenumber)}}function T(i,n){1&i&&(t.TgZ(0,"span",18),t._uU(1," Campo obligatorio "),t.qZA())}function C(i,n){1&i&&(t.TgZ(0,"span",18),t._uU(1," Valor invalido "),t.qZA())}function A(i,n){if(1&i&&(t.TgZ(0,"div",16),t.YNc(1,T,2,0,"span",17),t.YNc(2,C,2,0,"span",17),t.qZA()),2&i){const e=t.oxw();let o,r;t.xp6(1),t.Q6J("ngIf",null==(o=e.form.GetFormControlByName(e.productPriceForm,"salePrice"))?null:o.errors.required),t.xp6(1),t.Q6J("ngIf",null==(r=e.form.GetFormControlByName(e.productPriceForm,"salePrice"))?null:r.errors.pricenumber)}}function F(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",19),t.TgZ(1,"button",20),t.NdJ("click",function(){return t.CHM(e),t.oxw().UpdatePrice()}),t._uU(2," Actualizar "),t.qZA(),t.qZA()}}const x=function(i){return{"caret-active":i}};function H(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",21),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return r.showHistory=!r.showHistory}),t._UZ(1,"i",22),t.qZA()}if(2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngClass",t.VKq(1,x,e.showHistory))}}function q(i,n){if(1&i&&(t.TgZ(0,"div",23),t.TgZ(1,"div",14),t._uU(2),t.ALo(3,"date"),t.qZA(),t.TgZ(4,"div",14),t._uU(5),t.qZA(),t.TgZ(6,"div",14),t._uU(7),t.qZA(),t.qZA()),2&i){const e=n.$implicit;t.xp6(2),t.Oqu(t.xi3(3,3,e.date,"dd/MM/YYYY")),t.xp6(3),t.hij("$",e.purchasePrice,""),t.xp6(2),t.hij("$",e.salePrice,"")}}const b=function(i){return{"toggle-active":i}};let f=(()=>{class i{constructor(e,o,r){this.form=e,this.toast=o,this.http=r,this.product=null,this.history=!1,this.toggleHistory=null,this.onUpdate=new t.vpe,this.showHistory=!1,this.productPriceForm=new s.cw({id:new s.NI("",[s.kI.required]),purchasePrice:new s.NI("",[s.kI.required,(0,m.AW)()]),salePrice:new s.NI("",[s.kI.required,(0,m.AW)()])})}ngOnInit(){this.history&&this.productPriceForm.disable(),this.toggleHistory&&this.toggleHistory.subscribe(e=>{this.history="boolean"==typeof e?e:!this.history,this.history?this.productPriceForm.disable():this.productPriceForm.enable()}),this.productPriceForm.setValue({id:this.product.prices[0].id,purchasePrice:this.product.prices[0].purchasePrice,salePrice:this.product.prices[0].salePrice})}UpdatePrice(){if(this.productPriceForm.invalid)return void this.toast.ShowDefaultWarning("Los valores no son validos");let e=this.productPriceForm.value;this.http.Patch(`/PriceHistories/${e.id}/UpdatePrices`,{priceHistory:e}).subscribe(o=>{this.toast.ShowDefaultSuccess("Precios actualizados")},o=>{console.error("Error updating prices",o)})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(v.o),t.Y36(g.k),t.Y36(h.O))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-product-price-history"]],inputs:{product:"product",history:"history",toggleHistory:"toggleHistory"},outputs:{onUpdate:"onUpdate"},decls:33,vars:10,consts:[[1,"card","d-flex","flex-column"],[3,"formGroup"],[1,"d-flex","align-items-center","justify-content-around","flex-wrap"],[1,"name","mx-2"],[1,"form-group","mx-2"],[1,"input-container"],[1,"input-icon","zmdi","zmdi-money","zmdi-hc-lg"],["type","text","placeholder","Precio de compra","formControlName","purchasePrice",1,"form-control",3,"keyup.enter"],["class","error-messages",4,"ngIf"],["type","text","placeholder","Precio de venta","formControlName","salePrice",1,"form-control",3,"keyup.enter"],["class","mx-2",4,"ngIf"],["class","clickeable",3,"click",4,"ngIf"],[1,"d-flex","flex-column","price-history","position-relative",3,"ngClass"],[1,"div-table","t-header"],[1,"th"],["class","div-table t-body",4,"ngFor","ngForOf"],[1,"error-messages"],["class","d-block",4,"ngIf"],[1,"d-block"],[1,"mx-2"],[1,"btn","btn-success",3,"click"],[1,"clickeable",3,"click"],[1,"zmdi","zmdi-caret-down","zmdi-hc-3x",3,"ngClass"],[1,"div-table","t-body"]],template:function(e,o){if(1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"form",1),t.TgZ(2,"div",2),t.TgZ(3,"div",3),t._uU(4),t.qZA(),t.TgZ(5,"div",4),t.TgZ(6,"label"),t._uU(7," Precio de compra"),t.qZA(),t.TgZ(8,"div",5),t._UZ(9,"i",6),t.TgZ(10,"input",7),t.NdJ("keyup.enter",function(){return o.UpdatePrice()}),t.qZA(),t.qZA(),t.YNc(11,_,3,2,"div",8),t.qZA(),t.TgZ(12,"div",4),t.TgZ(13,"label"),t._uU(14," Precio de venta"),t.qZA(),t.TgZ(15,"div",5),t._UZ(16,"i",6),t.TgZ(17,"input",9),t.NdJ("keyup.enter",function(){return o.UpdatePrice()}),t.qZA(),t.qZA(),t.YNc(18,A,3,2,"div",8),t.qZA(),t.YNc(19,F,3,0,"div",10),t.YNc(20,H,2,3,"div",11),t.qZA(),t.qZA(),t.TgZ(21,"div",12),t.TgZ(22,"div",13),t.TgZ(23,"div",14),t.TgZ(24,"b"),t._uU(25,"Fecha"),t.qZA(),t.qZA(),t.TgZ(26,"div",14),t.TgZ(27,"b"),t._uU(28,"Precio de compra"),t.qZA(),t.qZA(),t.TgZ(29,"div",14),t.TgZ(30,"b"),t._uU(31,"Precio de venta"),t.qZA(),t.qZA(),t.qZA(),t.YNc(32,q,8,6,"div",15),t.qZA(),t.qZA()),2&e){let r,l;t.xp6(1),t.Q6J("formGroup",o.productPriceForm),t.xp6(3),t.Oqu(null==o.product?null:o.product.name),t.xp6(7),t.Q6J("ngIf",(null==(r=o.form.GetFormControlByName(o.productPriceForm,"purchasePrice"))?null:r.touched)&&(null==(r=o.form.GetFormControlByName(o.productPriceForm,"purchasePrice"))?null:r.errors)),t.xp6(7),t.Q6J("ngIf",(null==(l=o.form.GetFormControlByName(o.productPriceForm,"salePrice"))?null:l.touched)&&(null==(l=o.form.GetFormControlByName(o.productPriceForm,"salePrice"))?null:l.errors)),t.xp6(1),t.Q6J("ngIf",!o.history),t.xp6(1),t.Q6J("ngIf",o.history),t.xp6(1),t.Q6J("ngClass",t.VKq(8,b,o.showHistory)),t.xp6(11),t.Q6J("ngForOf",null==o.product?null:o.product.prices)}},directives:[s._Y,s.JL,s.sg,s.Fj,s.JJ,s.u,a.O5,a.mk,a.sg],pipes:[a.uU],styles:[".price-history[_ngcontent-%COMP%]{height:0px;overflow-y:hidden;transition:all .3s ease-in-out;position:relative}.form-group[_ngcontent-%COMP%]{margin:0}.toggle-active[_ngcontent-%COMP%]{margin-top:1.8rem;height:250px;overflow-y:auto}.zmdi-caret-down[_ngcontent-%COMP%]{transition:all .3s ease-in-out}.caret-active[_ngcontent-%COMP%]{transform:rotate(180deg)}.name[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600}.div-table[_ngcontent-%COMP%]{display:flex;align-items:center}.t-header[_ngcontent-%COMP%]{border-radius:12px 12px 0 0!important;background-color:#51a351!important;color:#fff;position:sticky;top:0}.t-body[_ngcontent-%COMP%]{border-top:1px solid #dee2e6}div.price-history[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:nth-of-type(odd){background:#F2F2F2}.th[_ngcontent-%COMP%]{height:50px;width:33%;display:flex;align-items:center;justify-content:center}.sticky-top[_ngcontent-%COMP%]{position:sticky;top:0}"]}),i})(),U=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[s.u5,a.ez,u.A0,s.UX]]}),i})();var N=c(4684),w=c(8260),k=c(9853),z=c(6155),J=c(1843),M=c(5749);function O(i,n){if(1&i&&(t.TgZ(0,"div",19),t._UZ(1,"app-product-price-history",20),t.qZA()),2&i){const e=n.$implicit,o=t.oxw();t.xp6(1),t.Q6J("product",e)("history",o.showingHistory)("toggleHistory",o.onShowHistory)}}let I=(()=>{class i{constructor(e,o,r,l,d){this.modal=e,this.toast=o,this.http=r,this.nav=l,this.csv=d,this.onShowHistory=new t.vpe,this.showingHistory=!1,this.products=[],this.filters=[],this.loading={getting:!1},this.InitializeFilters()}ngOnInit(){this.GetProducts()}InitializeFilters(){this.filters.push({type:"text",name:"text",placeholder:"Buscar"}),this.filters.push({type:"datepicker",name:"startDate",placeholder:"Fecha de inicio",config:null}),this.filters.push({type:"datepicker",name:"endDate",placeholder:"Fecha de fin",config:null})}GoHome(){this.nav.GoToRoleRoute("")}FormatDate(e){return e&&"*"!=e?N(e).tz(w.N.timezone).toISOString().split("T").shift():"*"}GetProducts(e=null){let o="Products/WithPriceHistory";e&&(o+=`/FilteredBy/Text/${e.text}/StartDate/${this.FormatDate(e.startDate)}/EndDate/${this.FormatDate(e.endDate)}`),this.loading.getting=!0,this.http.Get(o).subscribe(r=>{this.products=r,this.loading.getting=!1},r=>{console.error("Error getting products",r),this.loading.getting=!1})}GenerateCsv(){let r=[];this.products.forEach(l=>{r=r.concat(l.prices.map(d=>({product:l.name,date:d.date,purchasePrice:d.purchasePrice,salePrice:d.salePrice})))}),this.csv.GenerateCSV("lista_de_precios",r,["product","date","purchasePrice","salePrice"],["Producto","Fecha","Precio de compra","Precio de venta"])}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(k.Z),t.Y36(g.k),t.Y36(h.O),t.Y36(z.f),t.Y36(J.M))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-price-list"]],decls:23,vars:4,consts:[[1,"content"],[1,"d-flex","align-items-center","justify-content-between"],[1,"page-title"],[1,"zmdi","zmdi-home","zmdi-hc-lg","mr-2","clickeable",3,"click"],[1,"d-flex"],[1,"btn","btn-success","mx-1",3,"click"],[1,"zmdi","zmdi-assignment","zmdi-hc-lg","mr-2"],["id","csvBuyersDropdown","data-toggle","dropdown","aria-haspopup","true","aria-expanded","false",1,"clickeable","px-2"],[1,"btn","btn-success","mx-1"],[1,"zmdi","zmdi-file","zmdi-hc-lg","mr-2"],["aria-labelledby","csvBuyersDropdown",1,"dropdown-menu","px-1","py-1"],[1,"menu-list"],[1,"d-flex","align-items-center","px-3","my-1","clickeable-hover",3,"click"],[1,"zmdi","zmdi-download"],[1,"pl-2"],[1,"row"],[1,"col-12","mt-3","mb-4"],[3,"timerTrigger","filters","onSearch"],["class","col-12 my-3",4,"ngFor","ngForOf"],[1,"col-12","my-3"],[3,"product","history","toggleHistory"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"div",2),t.TgZ(3,"i",3),t.NdJ("click",function(){return o.GoHome()}),t.qZA(),t._uU(4," Lista de precios "),t.qZA(),t.TgZ(5,"div",4),t.TgZ(6,"button",5),t.NdJ("click",function(){return o.showingHistory=!o.showingHistory,o.onShowHistory.emit(o.showingHistory)}),t._UZ(7,"i",6),t._uU(8),t.qZA(),t.TgZ(9,"div",7),t.TgZ(10,"button",8),t._UZ(11,"i",9),t._uU(12," CSV "),t.qZA(),t.TgZ(13,"div",10),t.TgZ(14,"div",11),t.TgZ(15,"div",12),t.NdJ("click",function(){return o.GenerateCsv()}),t._UZ(16,"i",13),t.TgZ(17,"span",14),t._uU(18,"Exportar archivo"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(19,"div",15),t.TgZ(20,"div",16),t.TgZ(21,"app-filters",17),t.NdJ("onSearch",function(l){return o.GetProducts(l)}),t.qZA(),t.qZA(),t.YNc(22,O,2,3,"div",18),t.qZA(),t.qZA()),2&e&&(t.xp6(8),t.hij(" ",o.showingHistory?"Actualizar precio de hoy":"Ver historial"," "),t.xp6(13),t.Q6J("timerTrigger",!0)("filters",o.filters),t.xp6(1),t.Q6J("ngForOf",o.products))},directives:[M.b,a.sg,f],styles:[""]}),i})();var Y=c(3550);const G=[{path:"",component:I}];let L=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[s.u5,a.ez,Y.F,u.A0,s.UX,U,P.Bz.forChild(G)]]}),i})()}}]);