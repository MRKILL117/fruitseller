"use strict";(self.webpackChunkfront=self.webpackChunkfront||[]).push([[224],{7224:(U,c,a)=>{a.r(c),a.d(c,{PaymentsModule:()=>P});var r=a(6019),u=a(850),d=a(7537),g=a(1435),m=a(3550),p=a(4684),h=a(8260),t=a(1514),Z=a(6588),f=a(7754),_=a(1843),T=a(6155),v=a(5749);function x(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div",28),t.NdJ("click",function(){t.CHM(e);const s=t.oxw().$implicit;return t.oxw(3).ToggleStatusEdition(s)}),t._UZ(1,"i",29),t._uU(2),t.qZA()}if(2&i){const e=t.oxw().$implicit;t.xp6(2),t.hij(" ",e.status.name," ")}}function A(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div",30),t.TgZ(1,"i",31),t.NdJ("click",function(){t.CHM(e);const s=t.oxw().$implicit;return t.oxw(3).SaveOrderStatus(s)}),t.qZA(),t.TgZ(2,"ng-select",32),t.NdJ("ngModelChange",function(s){return t.CHM(e),t.oxw().$implicit.statusId=s}),t.qZA(),t.qZA()}if(2&i){const e=t.oxw().$implicit,n=t.oxw(3);t.xp6(2),t.Q6J("items",n.orderStatuses)("loading",n.loading.updating)("disabled",n.loading.updating)("ngModel",e.statusId)}}function y(i,o){if(1&i&&(t.TgZ(0,"tr"),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t.YNc(4,x,3,1,"div",26),t.YNc(5,A,3,4,"div",27),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.ALo(8,"date"),t.qZA(),t.TgZ(9,"td"),t._uU(10),t.qZA(),t.TgZ(11,"td"),t._uU(12),t.qZA(),t.TgZ(13,"td"),t._uU(14),t.qZA(),t.TgZ(15,"td"),t._uU(16),t.qZA(),t.qZA()),2&i){const e=o.$implicit;t.xp6(2),t.Oqu(e.id),t.xp6(2),t.Q6J("ngIf",!e.editStatus),t.xp6(1),t.Q6J("ngIf",!!e.editStatus),t.xp6(2),t.Oqu(t.xi3(8,8,e.date,"dd/MM/YYYY hh:mm a")),t.xp6(3),t.Oqu(e.client.name),t.xp6(2),t.hij("$",e.taxes,""),t.xp6(2),t.hij("$",e.subtotal,""),t.xp6(2),t.hij("$",e.total,"")}}function b(i,o){if(1&i&&(t.TgZ(0,"table",23),t.TgZ(1,"thead",24),t.TgZ(2,"tr"),t.TgZ(3,"th"),t._uU(4,"#"),t.qZA(),t.TgZ(5,"th"),t._uU(6,"Estatus"),t.qZA(),t.TgZ(7,"th"),t._uU(8,"Fecha"),t.qZA(),t.TgZ(9,"th"),t._uU(10,"Cliente"),t.qZA(),t.TgZ(11,"th"),t._uU(12,"Impuestos"),t.qZA(),t.TgZ(13,"th"),t._uU(14,"Subtotal"),t.qZA(),t.TgZ(15,"th"),t._uU(16,"Total"),t.qZA(),t._UZ(17,"th"),t.qZA(),t.qZA(),t.TgZ(18,"tbody"),t.YNc(19,y,17,11,"tr",25),t.qZA(),t.qZA()),2&i){const e=t.oxw(2);t.xp6(19),t.Q6J("ngForOf",e.orders)}}function S(i,o){if(1&i&&(t.TgZ(0,"div",16),t.YNc(1,b,20,1,"table",22),t.qZA()),2&i){const e=t.oxw(),n=t.MAs(43);t.xp6(1),t.Q6J("ngIf",!(null==e.orders||!e.orders.length))("ngIfElse",n)}}function C(i,o){1&i&&(t.TgZ(0,"div",33),t._UZ(1,"i",34),t.qZA())}function q(i,o){1&i&&(t.TgZ(0,"div",35),t._uU(1," No tiene ordenes por cobrar "),t.qZA())}const O=[{path:"",component:(()=>{class i{constructor(e,n,s,l){this.toast=e,this.http=n,this.csv=s,this.nav=l,this.clients=[],this.orders=[],this.orderStatuses=[],this.filters=[],this.loading={updating:!1,getting:!0},this.InitializeFilters()}ngOnInit(){this.GetOrderStatuses(),this.GetOrders()}InitializeFilters(){this.filters.push({type:"datepicker",name:"startDate",placeholder:"Fecha de inicio",config:null}),this.filters.push({type:"datepicker",name:"endDate",placeholder:"Fecha de fin",config:null})}GoHome(){this.nav.GoToRoleRoute("")}FormatDate(e){return e&&"*"!=e?p(e).tz(h.N.timezone).toISOString().split("T").shift():"*"}GetOrders(e=null){this.loading.getting=!0;let n="/Orders/OfPayments";e&&(n+=`/FilteredBy/StartDate/${this.FormatDate(e.startDate)}/EndDate/${this.FormatDate(e.endDate)}/Statuses/${JSON.stringify(e.status?[e.status]:[])}/Clients/${JSON.stringify(e.client?[e.client]:[])}`),this.http.Get(n).subscribe(s=>{this.orders=s,this.loading.getting=!1},s=>{console.error("Error getting orders",s),this.loading.getting=!1})}GetClients(){this.http.Get("/Clients").subscribe(e=>{this.filters.push({type:"select",name:"client",placeholder:"Cliente",config:{multiple:!1,options:e}})},e=>{console.error("Error getting clients",e)})}GetOrderStatuses(){this.http.Get("/OrderStatuses").subscribe(e=>{this.GetClients(),this.orderStatuses=e.filter(n=>n.id>=3),this.filters.push({type:"select",name:"status",placeholder:"Estado",config:{multiple:!1,options:this.orderStatuses}})},e=>{console.error("Error getting order statuses",e)})}GenerateCsv(){let s=this.orders.map(l=>({}));this.csv.GenerateCSV("cobranza",s,["id","status","date","client","taxes","subtotal","total"],["id","Estatus","Fecha","Cliente","Impuestos","Subtotal","Total"])}GetTotalOrdersByStatus(e){let n=0;return this.orders.forEach(s=>{e==s.status.name&&(n+=s.total)}),n}GoToOrder(e){localStorage.setItem("paymentMode",JSON.stringify(!0)),this.nav.GoToRoleRoute("edit-sell-orders/"+e.id)}ToggleStatusEdition(e){e.editStatus=!e.editStatus}SaveOrderStatus(e){e.statusId?(this.loading.updating=!0,this.http.Patch("/Orders",{order:e}).subscribe(n=>{this.toast.ShowDefaultSuccess("Estatus actualizado"),this.ToggleStatusEdition(e),this.GetOrders(),this.loading.updating=!1},n=>{console.error("Error updating order status",n),this.loading.updating=!1})):this.toast.ShowDefaultWarning("Selecciona un status")}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(Z.k),t.Y36(f.O),t.Y36(_.M),t.Y36(T.f))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-payments"]],decls:44,vars:16,consts:[[1,"content"],[1,"d-flex","align-items-center","justify-content-between"],[1,"page-title"],[1,"zmdi","zmdi-home","zmdi-hc-lg","mr-2","clickeable",3,"click"],[1,"d-flex"],["id","csvordersDropdown","data-toggle","dropdown","aria-haspopup","true","aria-expanded","false",1,"clickeable","px-2"],[1,"btn","btn-success","mx-1"],[1,"zmdi","zmdi-file","zmdi-hc-lg","mr-2"],["aria-labelledby","csvordersDropdown",1,"dropdown-menu","px-1","py-1"],[1,"menu-list"],[1,"d-flex","align-items-center","px-3","my-1","clickeable-hover",3,"click"],[1,"zmdi","zmdi-download"],[1,"pl-2"],[1,"row","justify-content-center"],[1,"col-12","mb-4"],[3,"timerTrigger","filters","onSearch"],[1,"col-12","col-lg-11"],[1,"total-card"],[1,"total"],["class","col-12 col-lg-11",4,"ngIf","ngIfElse"],["bigLoading",""],["noOrdersMessage",""],["class","table table-striped","style","overflow: visible;",4,"ngIf","ngIfElse"],[1,"table","table-striped",2,"overflow","visible"],[1,"table-thead"],[4,"ngFor","ngForOf"],["class","d-flex align-items-center clickeable","style","gap: 12px;",3,"click",4,"ngIf"],["class","d-flex align-items-center","style","gap: 12px;",4,"ngIf"],[1,"d-flex","align-items-center","clickeable",2,"gap","12px",3,"click"],[1,"zmdi","zmdi-edit","zmdi-hc-lg"],[1,"d-flex","align-items-center",2,"gap","12px"],[1,"zmdi","zmdi-save","zmdi-hc-lg","clickeable",3,"click"],["bindLabel","name","bindValue","id","placeholder","Selecciona un estatus",1,"flex-grow-1",3,"items","loading","disabled","ngModel","ngModelChange"],[1,"w-100","h-75","d-flex","align-items-center","justify-content-center",2,"min-height","min-content"],[1,"zmdi","zmdi-spinner","zmdi-hc-5x","zmdi-hc-spin"],[1,"no-items-message"]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"div",2),t.TgZ(3,"i",3),t.NdJ("click",function(){return n.GoHome()}),t.qZA(),t._uU(4," Cobranza "),t.qZA(),t.TgZ(5,"div",4),t.TgZ(6,"div",5),t.TgZ(7,"button",6),t._UZ(8,"i",7),t._uU(9," CSV "),t.qZA(),t.TgZ(10,"div",8),t.TgZ(11,"div",9),t.TgZ(12,"div",10),t.NdJ("click",function(){return n.GenerateCsv()}),t._UZ(13,"i",11),t.TgZ(14,"span",12),t._uU(15,"Exportar ordenes"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(16,"div",13),t.TgZ(17,"div",14),t.TgZ(18,"app-filters",15),t.NdJ("onSearch",function(l){return n.GetOrders(l)}),t.qZA(),t.qZA(),t.TgZ(19,"div",16),t.TgZ(20,"div",17),t.TgZ(21,"div",18),t.TgZ(22,"span"),t._uU(23,"Pendientes:"),t.qZA(),t.TgZ(24,"span"),t._uU(25),t.ALo(26,"number"),t.qZA(),t.qZA(),t.TgZ(27,"div",18),t.TgZ(28,"span"),t._uU(29,"Pagadas:"),t.qZA(),t.TgZ(30,"span"),t._uU(31),t.ALo(32,"number"),t.qZA(),t.qZA(),t.TgZ(33,"div",18),t.TgZ(34,"span"),t._uU(35,"Incobrables:"),t.qZA(),t.TgZ(36,"span"),t._uU(37),t.ALo(38,"number"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.YNc(39,S,2,2,"div",19),t.qZA(),t.qZA(),t.YNc(40,C,2,0,"ng-template",null,20,t.W1O),t.YNc(42,q,2,0,"ng-template",null,21,t.W1O)),2&e){const s=t.MAs(41);t.xp6(18),t.Q6J("timerTrigger",!0)("filters",n.filters),t.xp6(7),t.hij("$",t.xi3(26,7,n.GetTotalOrdersByStatus("Pendiente de pago"),"0.2-2"),""),t.xp6(6),t.hij("$",t.xi3(32,10,n.GetTotalOrdersByStatus("Pagado"),"0.2-2"),""),t.xp6(6),t.hij("$",t.xi3(38,13,n.GetTotalOrdersByStatus("Incobrable"),"0.2-2"),""),t.xp6(2),t.Q6J("ngIf",!n.loading.getting)("ngIfElse",s)}},directives:[v.b,r.O5,r.sg,g.w9,d.JJ,d.On],pipes:[r.JJ,r.uU],styles:[".total-card[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;border:1px solid #ccc;border-radius:12px;margin:1rem 0;padding:1.5rem}.total[_ngcontent-%COMP%]{display:flex;grid-gap:12px;gap:12px;font-size:2rem}.total[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child{font-weight:700}"]}),i})()}];let P=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[d.u5,r.ez,m.F,g.A0,d.UX,u.Bz.forChild(O)]]}),i})()}}]);