"use strict";(self.webpackChunkfront=self.webpackChunkfront||[]).push([[122],{3122:(L,p,s)=>{s.r(p),s.d(p,{DailyShoppingListModule:()=>F});var a=s(6019),y=s(850),l=s(7537),g=s(1435),v=s(3550),h=s(4684),f=s(8260),t=s(1514),Z=s(822),b=s(9853),T=s(6588),O=s(7754),q=s(1843),A=s(6155),C=s(5749);function x(i,d){if(1&i&&(t.TgZ(0,"div",12),t.TgZ(1,"div",10),t._uU(2),t.qZA(),t.TgZ(3,"div",10),t._uU(4),t.qZA(),t.qZA()),2&i){const e=d.$implicit,o=t.oxw();t.xp6(2),t.Oqu(e.id),t.xp6(2),t.Oqu(o.GetOrderProductShoppingQuantity(e)+" "+o.product.salesMeasurementType.abrev)}}const w=function(i){return{"mb-3":i}},P=function(i){return{"caret-active":i}},M=function(i){return{"toggle-active":i}};let m=(()=>{class i{constructor(){this.product=null,this.toggleHistory=null,this.showHistory=!1}ngOnInit(){this.toggleHistory&&this.toggleHistory.subscribe(e=>{})}GetOrderProductShoppingQuantity(e){if(!e||!this.product)return 0;const o=e.items.find(r=>r.product.id==this.product.id);if(!o)return 0;let n;return n=Number("pz"===o.product.inventoryMeasurementType.abrev?o.quantity?o.quantity:0:o.weight?o.weight:0),n}GetProductTotal(){let e=0;return this.product.orders.forEach(o=>{e+=this.GetOrderProductShoppingQuantity(o)}),e}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-product-orders"]],inputs:{product:"product",toggleHistory:"toggleHistory"},decls:41,vars:16,consts:[[1,"card","d-flex","flex-column"],[3,"ngClass"],[1,"d-flex","align-items-center","justify-content-around","flex-wrap"],[1,"name","mx-2"],[1,"mx-2"],[1,"text-center"],[1,"clickeable",3,"click"],[1,"zmdi","zmdi-caret-down","zmdi-hc-3x",3,"ngClass"],[1,"d-flex","flex-column","price-history","position-relative",3,"ngClass"],[1,"div-table","t-header"],[1,"th"],["class","div-table t-body",4,"ngFor","ngForOf"],[1,"div-table","t-body"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"div",2),t.TgZ(3,"div",3),t._uU(4),t.qZA(),t.TgZ(5,"div",4),t.TgZ(6,"label"),t._uU(7,"Unidad de medida"),t.qZA(),t.TgZ(8,"div",5),t._uU(9),t.qZA(),t.qZA(),t.TgZ(10,"div",4),t.TgZ(11,"label"),t._uU(12,"Comprador"),t.qZA(),t.TgZ(13,"div",5),t._uU(14),t.qZA(),t.qZA(),t.TgZ(15,"div",4),t.TgZ(16,"label"),t._uU(17,"Inventario"),t.qZA(),t.TgZ(18,"div",5),t._uU(19),t.qZA(),t.qZA(),t.TgZ(20,"div",4),t.TgZ(21,"label"),t._uU(22,"Total ordenes"),t.qZA(),t.TgZ(23,"div",5),t._uU(24),t.qZA(),t.qZA(),t.TgZ(25,"div",4),t.TgZ(26,"label"),t._uU(27,"Total a comprar"),t.qZA(),t.TgZ(28,"div",5),t._uU(29),t.qZA(),t.qZA(),t.TgZ(30,"div",6),t.NdJ("click",function(){return o.showHistory=!o.showHistory}),t._UZ(31,"i",7),t.qZA(),t.qZA(),t.qZA(),t.TgZ(32,"div",8),t.TgZ(33,"div",9),t.TgZ(34,"div",10),t.TgZ(35,"b"),t._uU(36,"Orden No."),t.qZA(),t.qZA(),t.TgZ(37,"div",10),t.TgZ(38,"b"),t._uU(39,"Cantidad"),t.qZA(),t.qZA(),t.qZA(),t.YNc(40,x,5,2,"div",11),t.qZA(),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngClass",t.VKq(10,w,o.showHistory)),t.xp6(3),t.Oqu(null==o.product?null:o.product.name),t.xp6(5),t.hij(" ",o.product.inventoryMeasurementType.abrev," "),t.xp6(5),t.hij(" ",null==o.product?null:o.product.buyer.name," "),t.xp6(5),t.hij(" 0 ",o.product.inventoryMeasurementType.abrev," "),t.xp6(5),t.hij(" ",o.GetProductTotal()+" "+o.product.inventoryMeasurementType.abrev," "),t.xp6(5),t.hij(" ",o.GetProductTotal()+" "+o.product.inventoryMeasurementType.abrev," "),t.xp6(2),t.Q6J("ngClass",t.VKq(12,P,o.showHistory)),t.xp6(1),t.Q6J("ngClass",t.VKq(14,M,o.showHistory)),t.xp6(8),t.Q6J("ngForOf",null==o.product?null:o.product.orders))},directives:[a.mk,a.sg],styles:[".price-history[_ngcontent-%COMP%]{height:0px;overflow-y:hidden;transition:all .3s ease-in-out;position:relative}.toggle-active[_ngcontent-%COMP%]{height:250px;overflow-y:auto}.zmdi-caret-down[_ngcontent-%COMP%]{transition:all .3s ease-in-out}.caret-active[_ngcontent-%COMP%]{transform:rotate(180deg)}.name[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600}.div-table[_ngcontent-%COMP%]{display:flex;align-items:center}.t-header[_ngcontent-%COMP%]{border-radius:12px 12px 0 0!important;background-color:#51a351!important;color:#fff;position:sticky;top:0}.t-body[_ngcontent-%COMP%]{border-top:1px solid #dee2e6}div.price-history[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:nth-of-type(odd){background:#F2F2F2}.th[_ngcontent-%COMP%]{height:50px;width:50%;display:flex;align-items:center;justify-content:center}.sticky-top[_ngcontent-%COMP%]{position:sticky;top:0}"]}),i})();const S=function(i){return{text:!1,startDate:!1,endDate:!1,options:i,optionsLabel:"Seleccione un comprador"}};function _(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"app-filters",19),t.NdJ("onSearch",function(n){return t.CHM(e),t.oxw().OnFiltersChanged(n)}),t.qZA()}if(2&i){const e=t.oxw();t.Q6J("timerTrigger",!0)("filters",t.VKq(2,S,e.buyers))}}function j(i,d){if(1&i&&(t.TgZ(0,"div",20),t._UZ(1,"app-product-orders",21),t.qZA()),2&i){const e=d.$implicit;t.xp6(1),t.Q6J("product",e)}}function U(i,d){1&i&&(t.TgZ(0,"div",22),t._UZ(1,"i",23),t.qZA())}function N(i,d){1&i&&(t.TgZ(0,"div",24),t._uU(1," No se encontraron ordenesactivas del dia de ayer "),t.qZA())}let D=(()=>{class i{constructor(e,o,n,r,c,u){this.form=e,this.modal=o,this.toast=n,this.http=r,this.csv=c,this.nav=u,this.today=h(),this.buyers=[],this.orders=[],this.clients=[],this.products=[],this.productsObj={},this.selectedOrder=null,this.isEditing=!1,this.ordersToUpload=[],this.ordersFailed=[],this.loading={updating:!1,getting:!0},this.dataConversions=[{oldKey:"Nombre",newKey:"name"},{oldKey:"Precio",newKey:"price"},{oldKey:"Impuesto",newKey:"tax"},{oldKey:"Unidad de medida ventas",newKey:"salesMeasurementType"},{oldKey:"Unidad de medida inventario",newKey:"inventoryMeasurementType"}]}get csvAcceptLabel(){return this.ordersFailed.length?"Reintentar":"Subir"}ngOnInit(){this.GetBuyers(),this.GetOrders(),this.GetClients()}GoHome(){this.nav.GoToRoleRoute("")}GetBuyers(){this.http.Get("Buyers").subscribe(e=>{this.buyers=e},e=>{console.error("Error getting buyers",e)})}OnFiltersChanged(e=null){this.SetProductsArray("*"==(null==e?void 0:e.options)?null:null==e?void 0:e.options)}GetClients(){this.http.Get("/Clients").subscribe(e=>{this.clients=e},e=>{console.error("Error getting clients",e)})}GetOrders(){this.loading.getting=!0;let e="/Orders";e+=`/FilteredBy/StartDate/${h().tz(f.N.timezone).subtract(1,"day").startOf("day").add(6,"hours").toISOString()}/EndDate/*`,this.http.Get(e).subscribe(n=>{this.orders=n,this.OnFiltersChanged(),this.loading.getting=!1},n=>{console.error("Error getting orders",n),this.loading.getting=!1})}SetProductsArray(e=null){this.products=[],this.productsObj={};let o=0;this.orders.forEach(n=>{n.items.forEach(r=>{e?e.id==r.product.buyer.id&&(this.productsObj[r.product.name]?(this.products[this.productsObj[r.product.name].arrayIdx].orders.push(n),this.products[this.productsObj[r.product.name].arrayIdx].weight+=Number(r.weight?r.weight:0),this.products[this.productsObj[r.product.name].arrayIdx].quantity+=Number(r.quantity?r.quantity:0),this.productsObj[r.product.name].productsDetected++):(this.products.push(Object.assign(Object.assign({},r.product),{orders:[n],weight:Number(r.weight?r.weight:0),quantity:Number(r.quantity?r.quantity:0)})),this.productsObj[r.product.name]={productsDetected:1,arrayIdx:o++})):this.productsObj[r.product.name]?(this.products[this.productsObj[r.product.name].arrayIdx].orders.push(n),this.products[this.productsObj[r.product.name].arrayIdx].weight+=Number(r.weight?r.weight:0),this.products[this.productsObj[r.product.name].arrayIdx].quantity+=Number(r.quantity?r.quantity:0),this.productsObj[r.product.name].productsDetected++):(this.products.push(Object.assign(Object.assign({},r.product),{orders:[n],weight:Number(r.weight?r.weight:0),quantity:Number(r.quantity?r.quantity:0)})),this.productsObj[r.product.name]={productsDetected:1,arrayIdx:o++})})})}GetOrderProductShoppingQuantity(e,o){if(!e||!o)return 0;const n=e.items.find(c=>c.product.id==o.id);if(!n)return 0;let r;return r=Number("pz"===n.product.inventoryMeasurementType.abrev?n.quantity?n.quantity:0:n.weight?n.weight:0),r}GetProductTotal(e){let o=0;return this.orders.forEach(n=>{o+=this.GetOrderProductShoppingQuantity(n,e)}),o}ExportData(){let e=["Producto","Unidad de medida","Inventario incial"],o=["product","measurement","inventory"];e=e.concat(this.orders.map(r=>`Pedido No. ${r.id}`)),o=o.concat(this.orders.map(r=>`order${r.id}`));let n=this.products.map(r=>{let c={product:r.name,measurement:r.inventoryMeasurementType.abrev,inventory:0,total:this.GetProductTotal(r)};return this.orders.forEach(u=>{c[`order${u.id}`]=this.GetOrderProductShoppingQuantity(u,r)}),c});e.push("Total"),o.push("total"),console.log(e),console.log(o),console.log(n),this.csv.GenerateCSV("compras_del_dia",n,o,e)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(Z.o),t.Y36(b.Z),t.Y36(T.k),t.Y36(O.O),t.Y36(q.M),t.Y36(A.f))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-daily-shopping-list"]],decls:24,vars:3,consts:[[1,"content"],[1,"d-flex","align-items-center","justify-content-between"],[1,"page-title"],[1,"zmdi","zmdi-home","zmdi-hc-lg","mr-2","clickeable",3,"click"],[1,"d-flex"],["id","csvordersDropdown","data-toggle","dropdown","aria-haspopup","true","aria-expanded","false",1,"clickeable","px-2"],[1,"btn","btn-success","mx-1"],[1,"zmdi","zmdi-file","zmdi-hc-lg","mr-2"],["aria-labelledby","csvordersDropdown",1,"dropdown-menu","px-1","py-1"],[1,"menu-list"],[1,"d-flex","align-items-center","px-3","my-1","clickeable-hover",3,"click"],[1,"zmdi","zmdi-file-plus"],[1,"pl-2"],[1,"row","justify-content-center"],[1,"col-12"],[3,"timerTrigger","filters","onSearch",4,"ngIf"],["class","col-12 my-4",4,"ngFor","ngForOf"],["bigLoading",""],["noOrdersMessage",""],[3,"timerTrigger","filters","onSearch"],[1,"col-12","my-4"],[3,"product"],[1,"w-100","h-75","d-flex","align-items-center","justify-content-center",2,"min-height","min-content"],[1,"zmdi","zmdi-spinner","zmdi-hc-5x","zmdi-hc-spin"],[1,"no-items-message"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"div",2),t.TgZ(3,"i",3),t.NdJ("click",function(){return o.GoHome()}),t.qZA(),t._uU(4),t.qZA(),t.TgZ(5,"div",4),t.TgZ(6,"div",5),t.TgZ(7,"button",6),t._UZ(8,"i",7),t._uU(9," CSV "),t.qZA(),t.TgZ(10,"div",8),t.TgZ(11,"div",9),t.TgZ(12,"div",10),t.NdJ("click",function(){return o.ExportData()}),t._UZ(13,"i",11),t.TgZ(14,"span",12),t._uU(15,"Exportar ordenes"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(16,"div",13),t.TgZ(17,"div",14),t.YNc(18,_,1,4,"app-filters",15),t.qZA(),t.YNc(19,j,2,1,"div",16),t.qZA(),t.qZA(),t.YNc(20,U,2,0,"ng-template",null,17,t.W1O),t.YNc(22,N,2,0,"ng-template",null,18,t.W1O)),2&e&&(t.xp6(4),t.hij(" Compras del dia ",o.today.format("DD/MM/YYYY")," "),t.xp6(14),t.Q6J("ngIf",!!o.buyers.length),t.xp6(1),t.Q6J("ngForOf",o.products))},directives:[a.O5,a.sg,C.b,m],styles:[""]}),i})(),z=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[l.u5,a.ez,g.A0,l.UX]]}),i})();const G=[{path:"",component:D}];let F=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[l.u5,a.ez,v.F,g.A0,z,l.UX,y.Bz.forChild(G)]]}),i})()}}]);